{
  "hash": "7423876bf9ddf461ceb8e445b236163a",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"How an ANOVA IS A REGRESSION WIHT DUMMY VARIABLES \"\nauthor: \"Bill Perry\"\nexecute:\n  freeze: auto\n  cache: true\n  echo: true\n  keep-md: true\n  message: false\n  warning: false\n  fig-height: 5\n  fig-width: 4\n  paged-print: false\nformat:\n  html:\n    toc: false\n    output-file: \"12_01_lecture_powerpoint_html.html\"\n    embed-resources: true\n    self-contained: true\n    max-width: 80ch\n    css: ../../css/lecture.css\n  revealjs:\n    output-file: \"12_01_lecture_powerpoint_slides.html\"\n    self-contained: true\n    css: ../../css/lecture.css\n    slide-number: true\n    transition: fade\n  docx:\n    default: true\n    toc: false\n    toc-depth: 3\n    number-sections: true\n    highlight-style: github\n    reference-doc: ../../ms_templates/custom-reference.docx\n    css: msword.css\n    embed-resources: true\n  pptx:\n    reference-doc: ../../ms_templates/lecture_template.pptx \n    embed-resources: true\neditor: visual\n---\n\n\n\n\n\n\n## Introduction\n\nThis document demonstrates how Analysis of Variance (ANOVA) is mathematically equivalent to a regression model with dummy variables using an example with R code and visualizations.\n\n## Setup and Data Creation\n\nLet's begin by loading necessary packages and creating a dataframe about plant heights with three different fertilizer treatments.\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(kableExtra)\n\n# Create the dataset\nfertilizer_data <- tibble(\n  fertilizer = rep(c(\"A\", \"B\", \"C\"), each = 3),\n  height = c(10, 12, 8,   # Fertilizer A\n             14, 16, 18,  # Fertilizer B\n             20, 22, 24)  # Fertilizer C\n)\n\n# Display the dataset\nfertilizer_data %>%\n  kbl() %>%\n  kable_styling(bootstrap_options = c(\"striped\", \"hover\"))\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-hover\" style=\"margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> fertilizer </th>\n   <th style=\"text-align:right;\"> height </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> A </td>\n   <td style=\"text-align:right;\"> 10 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> A </td>\n   <td style=\"text-align:right;\"> 12 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> A </td>\n   <td style=\"text-align:right;\"> 8 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> B </td>\n   <td style=\"text-align:right;\"> 14 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> B </td>\n   <td style=\"text-align:right;\"> 16 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> B </td>\n   <td style=\"text-align:right;\"> 18 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> C </td>\n   <td style=\"text-align:right;\"> 20 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> C </td>\n   <td style=\"text-align:right;\"> 22 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> C </td>\n   <td style=\"text-align:right;\"> 24 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n\n\n\n\n## Calculating Group Means (ANOVA Approach)\n\nIn ANOVA, we calculate the mean of each group and compare variation between groups to variation within groups.\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngroup_means <- fertilizer_data %>%\n  group_by(fertilizer) %>%\n  summarize(mean_height = mean(height))\n\ngroup_means %>%\n  kbl() %>%\n  kable_styling(bootstrap_options = c(\"striped\", \"hover\"))\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-hover\" style=\"margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> fertilizer </th>\n   <th style=\"text-align:right;\"> mean_height </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> A </td>\n   <td style=\"text-align:right;\"> 10 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> B </td>\n   <td style=\"text-align:right;\"> 16 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> C </td>\n   <td style=\"text-align:right;\"> 22 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n\n\n\n\nLet's visualize the raw data and group means:\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(fertilizer_data, aes(x = fertilizer, y = height)) +\n  geom_jitter(width = 0.1, alpha = 0.6) +\n  geom_point(data = group_means, aes(y = mean_height), \n             color = \"red\", size = 3) +\n  labs(title = \"Plant Height by Fertilizer Type\",\n       x = \"Fertilizer Type\",\n       y = \"Plant Height (cm)\") +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](how_anova_is_dummy_var_regression_files/figure-html/plot-raw-data-1.png){width=384}\n:::\n:::\n\n\n\n\n\n\n## Running the ANOVA\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Run ANOVA\nanova_model <- aov(height ~ fertilizer, data = fertilizer_data)\nanova_summary <- summary(anova_model)\nanova_summary\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n            Df Sum Sq Mean Sq F value Pr(>F)   \nfertilizer   2    216     108      27  0.001 **\nResiduals    6     24       4                  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n:::\n\n\n\n\n\n\n## Regression with Dummy Variables\n\nFor the regression approach, we'll create dummy variables for fertilizer types, using fertilizer A as the reference level.\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Set fertilizer A as the reference level\nfertilizer_data$fertilizer <- factor(fertilizer_data$fertilizer, levels = c(\"A\", \"B\", \"C\"))\n\n# Run regression with dummy variables\nreg_model <- lm(height ~ fertilizer, data = fertilizer_data)\nreg_summary <- summary(reg_model)\nreg_summary\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = height ~ fertilizer, data = fertilizer_data)\n\nResiduals:\n   Min     1Q Median     3Q    Max \n    -2     -2      0      2      2 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept)   10.000      1.155   8.660 0.000131 ***\nfertilizerB    6.000      1.633   3.674 0.010402 *  \nfertilizerC   12.000      1.633   7.348 0.000325 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 2 on 6 degrees of freedom\nMultiple R-squared:    0.9,\tAdjusted R-squared:  0.8667 \nF-statistic:    27 on 2 and 6 DF,  p-value: 0.001\n```\n\n\n:::\n:::\n\n\n\n\n\n\n## Understanding the Regression Coefficients\n\nIn our regression model:\n\n-   The intercept (10) is equal to the mean of the reference group (A)\n-   The coefficient for fertilizer B (6) is the difference between mean of group B and mean of group A\n-   The coefficient for fertilizer C (12) is the difference between mean of group C and mean of group A\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create a table showing the relationship between coefficients and means\ncoefs <- coef(reg_model)\n\ncoefficients_explained <- tibble(\n  Term = c(\"Intercept\", \"fertilizerB\", \"fertilizerC\"),\n  Coefficient = coefs,\n  Meaning = c(\n    \"Mean of Group A (reference group)\",\n    \"Difference between Group B and Group A means\",\n    \"Difference between Group C and Group A means\"\n  ),\n  Mathematical_Expression = c(\n    \"β₀ = μA\",\n    \"β₁ = μB - μA\",\n    \"β₂ = μC - μA\"\n  ),\n  Numeric_Value = c(\n    coefs[1],\n    paste0(round(group_means$mean_height[2], 1), \" - \", \n           round(group_means$mean_height[1], 1), \" = \", \n           round(coefs[2], 1)),\n    paste0(round(group_means$mean_height[3], 1), \" - \", \n           round(group_means$mean_height[1], 1), \" = \", \n           round(coefs[3], 1))\n  )\n)\n\ncoefficients_explained %>%\n  kbl(caption = \"Regression Coefficients Explained\") %>%\n  kable_styling(bootstrap_options = c(\"striped\", \"hover\"))\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-hover\" style=\"margin-left: auto; margin-right: auto;\">\n<caption>Regression Coefficients Explained</caption>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> Term </th>\n   <th style=\"text-align:right;\"> Coefficient </th>\n   <th style=\"text-align:left;\"> Meaning </th>\n   <th style=\"text-align:left;\"> Mathematical_Expression </th>\n   <th style=\"text-align:left;\"> Numeric_Value </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> Intercept </td>\n   <td style=\"text-align:right;\"> 10 </td>\n   <td style=\"text-align:left;\"> Mean of Group A (reference group) </td>\n   <td style=\"text-align:left;\"> β₀ = μA </td>\n   <td style=\"text-align:left;\"> 10 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> fertilizerB </td>\n   <td style=\"text-align:right;\"> 6 </td>\n   <td style=\"text-align:left;\"> Difference between Group B and Group A means </td>\n   <td style=\"text-align:left;\"> β₁ = μB - μA </td>\n   <td style=\"text-align:left;\"> 16 - 10 = 6 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> fertilizerC </td>\n   <td style=\"text-align:right;\"> 12 </td>\n   <td style=\"text-align:left;\"> Difference between Group C and Group A means </td>\n   <td style=\"text-align:left;\"> β₂ = μC - μA </td>\n   <td style=\"text-align:left;\"> 22 - 10 = 12 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n\n\n\n\nLet's visualize these coefficients:\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncoef_data <- tibble(\n  Term = factor(c(\"Intercept\\n(Group A Mean)\", \"Group B - Group A\", \"Group C - Group A\"),\n                levels = c(\"Intercept\\n(Group A Mean)\", \"Group B - Group A\", \"Group C - Group A\")),\n  Value = c(coefs[1], coefs[2], coefs[3])\n)\n\nggplot(coef_data, aes(x = Term, y = Value)) +\n  geom_col(fill = \"steelblue\") +\n  geom_text(aes(label = round(Value, 1)), vjust = -0.5) +\n  labs(title = \"Regression Coefficients with Dummy Variables\",\n       subtitle = \"Intercept represents Group A mean; other coefficients show differences from reference\",\n       x = \"\",\n       y = \"Coefficient Value (cm)\") +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](how_anova_is_dummy_var_regression_files/figure-html/plot-coefficients-1.png){width=384}\n:::\n:::\n\n\n\n\n\n\n## Demonstrating the Equivalence\n\nNow, let's prove that the regression model predictions are identical to the ANOVA group means:\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Get predictions from regression model\npredicted_values <- predict(reg_model, fertilizer_data)\n\n# Create a dataframe for comparison\ncomparison_data <- fertilizer_data %>%\n  mutate(predicted = predicted_values) %>%\n  group_by(fertilizer) %>%\n  mutate(group_mean = mean(height))\n\n# Generate the predicted values for each group\npredicted_values_by_group <- comparison_data %>%\n  group_by(fertilizer) %>%\n  reframe(\n    anova_mean = mean(height),\n    regression_prediction = mean(predicted),\n    formula = case_when(\n      fertilizer == \"A\" ~ paste0(round(coefs[1], 1), \" + 0 + 0 = \", round(coefs[1], 1)),\n      fertilizer == \"B\" ~ paste0(round(coefs[1], 1), \" + \", round(coefs[2], 1), \" + 0 = \", round(coefs[1] + coefs[2], 1)),\n      fertilizer == \"C\" ~ paste0(round(coefs[1], 1), \" + 0 + \", round(coefs[3], 1), \" = \", round(coefs[1] + coefs[3], 1))\n    )\n  )\n```\n:::\n\n\n\n\n\n\nLet's visualize this equivalence:\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create data for plotting the equivalence\nplot_data <- predicted_values_by_group %>%\n  pivot_longer(cols = c(anova_mean, regression_prediction),\n               names_to = \"method\",\n               values_to = \"value\") %>%\n  mutate(method = ifelse(method == \"anova_mean\", \"ANOVA Group Mean\", \"Regression Prediction\"))\n\nggplot(plot_data, aes(x = fertilizer, y = value, fill = method)) +\n  geom_bar(stat = \"identity\", position = position_dodge(), alpha = 0.7) +\n  geom_text(aes(label = round(value, 1)), position = position_dodge(width = 0.9), vjust = -0.5) +\n  labs(title = \"ANOVA Mean vs. Regression Prediction by Fertilizer Type\",\n       subtitle = \"Both methods produce identical values\",\n       x = \"Fertilizer Type\",\n       y = \"Plant Height (cm)\",\n       fill = \"Method\") +\n  theme_minimal() +\n  scale_fill_brewer(palette = \"Set1\")\n```\n\n::: {.cell-output-display}\n![](how_anova_is_dummy_var_regression_files/figure-html/equivalence-plot-1.png){width=384}\n:::\n:::\n\n\n\n\n\n\n## Comparing Statistical Tests\n\nBoth ANOVA and regression provide an F-test. Let's compare them:\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# ANOVA: Extract F-value and p-value\nanova_f <- anova_summary[[1]]$`F value`[1]\nanova_p <- anova_summary[[1]]$`Pr(>F)`[1]\n\n# Regression: Extract F-value and p-value\nreg_f <- reg_summary$fstatistic[1]\nreg_p <- pf(reg_f, reg_summary$fstatistic[2], reg_summary$fstatistic[3], lower.tail = FALSE)\n\n# Compare them\ntest_comparison <- tibble(\n  Test = c(\"ANOVA F-test\", \"Regression F-test\"),\n  `F-value` = c(anova_f, reg_f),\n  `p-value` = c(anova_p, reg_p)\n)\n\ntest_comparison %>%\n  kbl(caption = \"Comparison of Statistical Tests\") %>%\n  kable_styling(bootstrap_options = c(\"striped\", \"hover\"))\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-hover\" style=\"margin-left: auto; margin-right: auto;\">\n<caption>Comparison of Statistical Tests</caption>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> Test </th>\n   <th style=\"text-align:right;\"> F-value </th>\n   <th style=\"text-align:right;\"> p-value </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> ANOVA F-test </td>\n   <td style=\"text-align:right;\"> 27 </td>\n   <td style=\"text-align:right;\"> 0.001 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Regression F-test </td>\n   <td style=\"text-align:right;\"> 27 </td>\n   <td style=\"text-align:right;\"> 0.001 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n\n\n\n\n## The Mathematical Relationship\n\nFor a one-way ANOVA with a categorical variable having `k` levels, we can express the relationship with regression as:\n\n$$Y = \\beta_0 + \\beta_1X_1 + \\beta_2X_2 + ... + \\beta_{k-1}X_{k-1} + \\epsilon$$\n\nWhere: - $\\beta_0$ is the mean of the reference group - $\\beta_1, \\beta_2, ..., \\beta_{k-1}$ are the differences between each group's mean and the reference group mean - $X_1, X_2, ..., X_{k-1}$ are dummy variables (0 or 1)\n\nIn our example: - $\\beta_0 = 10$ (mean of group A) - $\\beta_1 = 6$ (difference between B and A) - $\\beta_2 = 12$ (difference between C and A)\n\n## Conclusion\n\nThis demonstration shows that one-way ANOVA is mathematically equivalent to regression with dummy variables. The key equivalences are:\n\n1.  ANOVA group means = Regression predictions for each group\n2.  F-statistic from ANOVA = F-statistic from regression\n3.  p-values are identical in both approaches\n\nThis confirms that both techniques are special cases of the General Linear Model, just expressed in different ways. For a categorical predictor with `k` levels, we need `k-1` dummy variables in the regression approach, with one level serving as the reference category.\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"site_libs/kePrint-0.0.1/kePrint.js\"></script>\n<link href=\"site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}