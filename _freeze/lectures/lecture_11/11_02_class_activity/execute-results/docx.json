{
  "hash": "e081ad14dfc2aa895bba817f1a3b817c",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Lecture 11 - Class Activity: Multiple Regression\"\nauthor: \"Your Name\"\nexecute:\n  freeze: auto\n  cache: true\n  echo: true\n  keep-md: true\n  fig-height: 4\n  fig-width: 6\n  paged-print: false\nformat:\n  html:\n    freeze: false\n    toc: false\n    output-file: \"11_02_class_activity.html\"\n    default: true\n    embed-resources: true\n    self-contained: true\n    max-width: 80ch\n    css: ../../css/activity.css\n  docx:\n    default: true\n    toc: false\n    toc-depth: 3\n    number-sections: false\n    highlight-style: github\n    reference-doc: ../../ms_templates/custom-reference.docx\n    css: msword.css\n    embed-resources: true\n---\n\n\n\n\n\n\n\n\n\n\n# Analysis of Net Primary Production in Forests: A Modern Tidyverse Approach\n\n*Based on Michaletz et al. (2014) data*\n\n## Introduction\n\nThis analysis examines the relationships between Net Primary Production\n(npp) and various climate and forest characteristics across global\nforest sites. We'll explore multicollinearity, model selection, and\nvariable transformations.\n\n**Key Learning Objectives:**\n\n-   Understand multicollinearity in multiple regression\n-   Learn model diagnostics and assumption checking\n-   Practice variable selection techniques\n-   Apply data transformations appropriately\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n## Load Required Packages\n\n\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load required packages\nlibrary(tidyverse)    # For data manipulation and visualization\nlibrary(car)          # For regression diagnostics (VIF, etc.)\nlibrary(corrplot)     # For correlation plots\nlibrary(GGally)       # For pairs plots\nlibrary(broom)        # For tidy model outputs\nlibrary(performance)  # For model performance metrics\nlibrary(see)          # For better diagnostic plots\n```\n:::\n\n\n\n\n\n\n\n\n\n\n## Load and Explore the Data\n\n\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load the forest npp data\nforest_data <- read_csv(\"data/michaletz_etal_2014.csv\")\n\n# Display top lines\nhead(forest_data)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 15\n  Index    Lat  Long NPPTotal_gm2y Age_yr BiomassTotal_gm2 Lgs_mo MAT_C MAP_mm\n  <dbl>  <dbl> <dbl>         <dbl>  <dbl>            <dbl>  <dbl> <dbl>  <dbl>\n1  1243 -13.1  -52.4          2084   104.           18198.     11 25.3   1888 \n2  1241  -1.72 -51.4          2234   333.           54523.     12 26.9   2348.\n3  1242  -1.72 -51.4          2714   213.           41358.     12 26.9   2348.\n4  1235  -3.95 -73.4          2828   114.           31557.     12 26.7   2784.\n5  1236  -3.95 -73.4          2882   113.           21417      12 26.7   2784.\n6   672  51.7  113.            774    79            11188       3 -3.53   408.\n# ℹ 6 more variables: LeafType <chr>, TEB_DD <dbl>, Source <chr>,\n#   SourceIndex <chr>, SourcePrimary <chr>,\n#   `Methodology for biomass and production` <chr>\n```\n\n\n:::\n:::\n\n\n\n\n\n\n\n\n\n\n## Data Preparation\n\nFollowing the original analysis, we'll focus on the key variables and\ncreate our working dataframe:\n\n\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create working dataset with key variables\n# Following the original script's variable selection\nforest_clean <- forest_data %>%\n  select(\n    npp = NPPTotal_gm2y,           # Net Primary Production (response variable)\n    age =  Age_yr,                   # Stand age in years\n    biomass =  BiomassTotal_gm2,     # Total biomass\n    season =  Lgs_mo,        # Length of growing season in months\n    temp =  MAT_C,            # Mean annual temperature\n    precip  = MAP_mm,         # Mean annual precipitation\n    teb =  TEB_DD,                   # Thermal environment\n    leaf = LeafType                        # Leaf type (categorical)\n  ) %>%\n  # Remove any rows with missing values in key variables\n  drop_na()\n\nforest_clean <- forest_clean %>% mutate(leaf = as.factor(leaf))\n\n\n# Display the cleaned dataset\nglimpse(forest_clean)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 1,220\nColumns: 8\n$ npp     <dbl> 2084, 2234, 2714, 2828, 2882, 774, 1052, 3100, 2254, 785, 1673…\n$ age     <dbl> 104.429, 333.268, 213.382, 114.231, 113.477, 79.000, 60.000, 6…\n$ biomass <dbl> 18198.4, 54522.6, 41357.8, 31556.8, 21417.0, 11188.0, 24520.0,…\n$ season  <dbl> 11, 12, 12, 12, 12, 3, 6, 12, 12, 6, 6, 5, 5, 5, 5, 5, 5, 5, 5…\n$ temp    <dbl> 25.283333, 26.916667, 26.916667, 26.725000, 26.725000, -3.5333…\n$ precip  <dbl> 1888.0, 2348.5, 2348.5, 2784.4, 2784.4, 407.8, 1128.7, 1079.3,…\n$ teb     <dbl> 0.55, 0.60, 0.60, 1.25, 1.25, 1.80, 2.05, 2.05, 2.05, 2.05, 2.…\n$ leaf    <fct> broadleaf, broadleaf, broadleaf, broadleaf, broadleaf, broadle…\n```\n\n\n:::\n:::\n\n\n\n\n\n\n\n\n\n\n## 1. Initial Exploration: Variable Relationships and Multicollinearity\n\n### Correlation Matrix and Visualization\n\n\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create correlation matrix for numeric variables only\nnumeric_vars <- forest_clean %>%\n  select_if(is.numeric)\n\n# Calculate correlation matrix\ncor_matrix <- cor(numeric_vars, use = \"complete.obs\")\n\n# Display correlation matrix\nprint(round(cor_matrix, 3))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n           npp    age biomass season   temp precip    teb\nnpp      1.000 -0.153   0.459  0.561  0.552  0.531 -0.317\nage     -0.153  1.000   0.592 -0.272 -0.231  0.004 -0.012\nbiomass  0.459  0.592   1.000  0.132  0.155  0.354 -0.275\nseason   0.561 -0.272   0.132  1.000  0.923  0.568 -0.249\ntemp     0.552 -0.231   0.155  0.923  1.000  0.577 -0.250\nprecip   0.531  0.004   0.354  0.568  0.577  1.000 -0.291\nteb     -0.317 -0.012  -0.275 -0.249 -0.250 -0.291  1.000\n```\n\n\n:::\n\n```{.r .cell-code}\n# Create a visual correlation plot\ncorrplot(cor_matrix, method = \"color\", type = \"upper\", \n         addCoef.col = \"black\", tl.cex = 0.8, number.cex = 0.7,\n         title = \"Correlation Matrix of Forest Variables\")\n```\n\n::: {.cell-output-display}\n![](11_02_class_activity_files/figure-docx/correlation-analysis-1.png)\n:::\n:::\n\n\n\n\n\n\n\n\n\n\n### Pairs Plot for Visual Inspection\n\n\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create pairs plot to visualize relationships\n# This replaces the original pairs() function with ggplot2\nforest_clean %>%\n  select(-leaf) %>%  # Exclude categorical variable for pairs plot\n  ggpairs(\n    title = \"Pairwise Relationships Between Forest Variables\",\n    upper = list(continuous = wrap(\"cor\", size = 3)),\n    lower = list(continuous = wrap(\"points\", alpha = 0.6, size = 0.8))\n  ) +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](11_02_class_activity_files/figure-docx/pairs-plot-1.png)\n:::\n:::\n\n\n\n\n\n\n\n\n\n\n## 2. Initial Multiple Regression Model\n\nLet's start with a full model including all predictors:\n\n\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Fit initial model with all predictors (Model 1)\nmodel1 <- lm(npp ~ age + biomass + season + temp + \n             precip + teb + leaf, data = forest_clean)\n\n# Get model summary\nsummary(model1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = npp ~ age + biomass + season + temp + precip + teb + \n    leaf, data = forest_clean)\n\nResiduals:\n     Min       1Q   Median       3Q      Max \n-1331.10  -206.27   -34.09   166.94  2760.41 \n\nCoefficients:\n              Estimate Std. Error t value Pr(>|t|)    \n(Intercept)  583.92959   53.81169  10.851  < 2e-16 ***\nage           -4.78822    0.28518 -16.790  < 2e-16 ***\nbiomass        0.03154    0.00122  25.848  < 2e-16 ***\nseason        41.18220    9.49073   4.339 1.55e-05 ***\ntemp           4.61281    4.37372   1.055 0.291788    \nprecip         0.09674    0.02852   3.392 0.000716 ***\nteb           -2.12880    1.08408  -1.964 0.049794 *  \nleafneedle  -267.00569   22.43078 -11.904  < 2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 351.7 on 1212 degrees of freedom\nMultiple R-squared:  0.6415,\tAdjusted R-squared:  0.6394 \nF-statistic: 309.8 on 7 and 1212 DF,  p-value: < 2.2e-16\n```\n\n\n:::\n:::\n\n\n\n\n\n\n\n\n\n\n### Check for Multicollinearity\n\n\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Calculate Variance Inflation Factors (VIF)\nvif_values <- vif(model1)\nprint(\"Variance Inflation Factors:\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"Variance Inflation Factors:\"\n```\n\n\n:::\n\n```{.r .cell-code}\nprint(vif_values)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n     age  biomass   season     temp   precip      teb     leaf \n1.993348 2.061766 7.079004 6.972147 1.831127 1.167007 1.236588 \n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create a data frame for better visualization\nvif_df <- data.frame(\n  Variable = names(vif_values),\n  VIF = as.numeric(vif_values)\n) %>%\n  arrange(desc(VIF))\n\n# Visualize VIF values\nggplot(vif_df, aes(x = reorder(Variable, VIF), y = VIF)) +\n  geom_col(fill = \"steelblue\", alpha = 0.7) +\n  geom_hline(yintercept = 10, color = \"red\", linetype = \"dashed\", \n             linewidth = 1) +\n  geom_hline(yintercept = 5, color = \"orange\", linetype = \"dashed\", \n             linewidth = 1) +\n  coord_flip() +\n  labs(\n    title = \"Variance Inflation Factors\",\n    subtitle = \"Red line: VIF = 10 (serious concern), Orange line: VIF = 5 (moderate concern)\",\n    x = \"Variables\",\n    y = \"VIF\"\n  ) +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](11_02_class_activity_files/figure-docx/unnamed-chunk-1-1.png)\n:::\n:::\n\n\n\n\n\n\n\n\n\n\n### Address Multicollinearity by Removing Growing Season\n\nBased on the original analysis, season and Temperature are highly\ncorrelated. Let's remove season:\n\n\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Model 2: Remove season due to multicollinearity\nmodel2 <- lm(npp ~ age + biomass + temp + precip + teb + leaf, \n             data = forest_clean)\n\n# Model summary\nsummary(model2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = npp ~ age + biomass + temp + precip + teb + leaf, \n    data = forest_clean)\n\nResiduals:\n     Min       1Q   Median       3Q      Max \n-1309.94  -209.40   -42.65   167.71  2898.47 \n\nCoefficients:\n              Estimate Std. Error t value Pr(>|t|)    \n(Intercept)  7.511e+02  3.785e+01  19.845  < 2e-16 ***\nage         -5.004e+00  2.829e-01 -17.690  < 2e-16 ***\nbiomass      3.180e-02  1.228e-03  25.905  < 2e-16 ***\ntemp         2.112e+01  2.173e+00   9.718  < 2e-16 ***\nprecip       1.120e-01  2.851e-02   3.929 9.02e-05 ***\nteb         -2.255e+00  1.092e+00  -2.066    0.039 *  \nleafneedle  -2.634e+02  2.258e+01 -11.666  < 2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 354.3 on 1213 degrees of freedom\nMultiple R-squared:  0.6359,\tAdjusted R-squared:  0.6341 \nF-statistic: 353.1 on 6 and 1213 DF,  p-value: < 2.2e-16\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Check VIF again\nvif_values2 <- vif(model2)\nprint(\"VIF values after removing season:\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"VIF values after removing season:\"\n```\n\n\n:::\n\n```{.r .cell-code}\nprint(vif_values2)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n     age  biomass     temp   precip      teb     leaf \n1.932806 2.056724 1.696787 1.803266 1.166162 1.234906 \n```\n\n\n:::\n:::\n\n\n\n\n\n\n\n\n\n\n## 3. Exploring Variable Transformations\n\n### Check the Shape of Relationships with Partial Regression Plots\n\n\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create partial regression plots (Added Variable Plots)\n# This helps us see the relationship between each predictor and response\n# after accounting for other variables\n\npar(mfrow = c(2, 3))\navPlots(model2, main = \"Partial Regression Plots\")\n```\n\n::: {.cell-output-display}\n![](11_02_class_activity_files/figure-docx/partial-plots-1.png)\n:::\n\n```{.r .cell-code}\npar(mfrow = c(1, 1))\n```\n:::\n\n\n\n\n\n\n\n\n\n\n### Apply Log Transformation to age\n\nThe original analysis found that age showed a curvy relationship. Let's\ntry log transformation:\n\n\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create dataset with log-transformed age\nforest_transformed <- forest_clean %>%\n  mutate(log_age = log10(age))\n\n# Model 3: With log-transformed age\nmodel3 <- lm(npp ~ log_age + biomass + temp + precip + teb + leaf, \n             data = forest_transformed)\n\n\n# Model summary\nsummary(model3)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = npp ~ log_age + biomass + temp + precip + teb + \n    leaf, data = forest_transformed)\n\nResiduals:\n     Min       1Q   Median       3Q      Max \n-1282.97  -203.31   -23.13   163.75  2810.76 \n\nCoefficients:\n              Estimate Std. Error t value Pr(>|t|)    \n(Intercept)  2.237e+03  8.961e+01  24.962  < 2e-16 ***\nlog_age     -1.012e+03  5.064e+01 -19.973  < 2e-16 ***\nbiomass      3.313e-02  1.194e-03  27.755  < 2e-16 ***\ntemp         1.723e+01  2.159e+00   7.982 3.33e-15 ***\nprecip       7.194e-02  2.781e-02   2.587  0.00981 ** \nteb         -2.315e+00  1.061e+00  -2.183  0.02925 *  \nleafneedle  -2.852e+02  2.177e+01 -13.105  < 2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 344.7 on 1213 degrees of freedom\nMultiple R-squared:  0.6553,\tAdjusted R-squared:  0.6536 \nF-statistic: 384.4 on 6 and 1213 DF,  p-value: < 2.2e-16\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Compare partial regression plots\npar(mfrow = c(2, 3))\navPlots(model3, main = \"Partial Regression Plots (Log age)\")\n```\n\n::: {.cell-output-display}\n![](11_02_class_activity_files/figure-docx/unnamed-chunk-3-1.png)\n:::\n\n```{.r .cell-code}\npar(mfrow = c(1, 1))\n```\n:::\n\n\n\n\n\n\n\n\n\n\n## 4. Model Diagnostics and Assumption Checking\n\n\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create diagnostic plots\npar(mfrow = c(2, 2))\nplot(model3, main = \"Model Diagnostics\")\n```\n\n::: {.cell-output-display}\n![](11_02_class_activity_files/figure-docx/diagnostics-1.png)\n:::\n\n```{.r .cell-code}\npar(mfrow = c(1, 1))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Check for normality of residuals\nresiduals_data <- data.frame(\n  Fitted = fitted(model3),\n  Residuals = residuals(model3),\n  Standardized_Residuals = rstandard(model3)\n)\n\n# Residuals vs Fitted plot using ggplot\nggplot(residuals_data, aes(x = Fitted, y = Residuals)) +\n  geom_point(alpha = 0.6) +\n  geom_smooth(method = \"lm\", color = \"red\") +\n  geom_hline(yintercept = 0, linetype = \"dashed\") +\n  labs(\n    title = \"Residuals vs Fitted Values\",\n    x = \"Fitted Values\",\n    y = \"Residuals\"\n  ) +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](11_02_class_activity_files/figure-docx/unnamed-chunk-4-1.png)\n:::\n:::\n\n\n\n\n\n\n\n\n\n\n### Try Response Variable Transformation\n\nFollowing the original analysis, let's try a cube root transformation of\nnpp:\n\n\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Model 4: Cube root transformation of npp\nforest_transformed <- forest_transformed %>%\n  mutate(npp_cuberoot = npp^(1/3))\n\nmodel4 <- lm(npp_cuberoot ~ log_age + biomass + temp + precip + \n             teb + leaf, data = forest_transformed)\n\n# Check diagnostics\npar(mfrow = c(2, 2))\nplot(model4, main = \"Model Diagnostics (Cube Root npp)\")\n```\n\n::: {.cell-output-display}\n![](11_02_class_activity_files/figure-docx/response-transformation-1.png)\n:::\n\n```{.r .cell-code}\npar(mfrow = c(1, 1))\n\n# Model summary\ntidy(model4)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 7 × 5\n  term          estimate  std.error statistic   p.value\n  <chr>            <dbl>      <dbl>     <dbl>     <dbl>\n1 (Intercept) 13.9       0.260         53.5   2.06e-321\n2 log_age     -3.15      0.147        -21.4   1.07e- 86\n3 biomass      0.000103  0.00000346    29.8   8.32e-147\n4 temp         0.0451    0.00627        7.19  1.10e- 12\n5 precip       0.0000636 0.0000807      0.788 4.31e-  1\n6 teb         -0.0127    0.00308       -4.13  3.79e-  5\n7 leafneedle  -1.03      0.0632       -16.3   4.57e- 54\n```\n\n\n:::\n\n```{.r .cell-code}\nglance(model4)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1 × 12\n  r.squared adj.r.squared sigma statistic   p.value    df logLik   AIC   BIC\n      <dbl>         <dbl> <dbl>     <dbl>     <dbl> <dbl>  <dbl> <dbl> <dbl>\n1     0.679         0.678  1.00      428. 2.43e-295     6 -1728. 3472. 3513.\n# ℹ 3 more variables: deviance <dbl>, df.residual <int>, nobs <int>\n```\n\n\n:::\n:::\n\n\n\n\n\n\n\n\n\n\n## 5. Model Simplification and Comparison\n\n### Remove Non-significant Variables\n\n\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Model 5: Remove non-significant Precipitation\nmodel5 <- lm(npp_cuberoot ~ log_age + biomass + temp + teb + leaf, \n             data = forest_transformed)\n\n# Compare models using AIC\nmodel_comparison <- data.frame(\n  Model = c(\"Model 4 (Full)\", \"Model 5 (No precip)\"),\n  AIC = c(AIC(model4), AIC(model5)),\n  R_squared = c(summary(model4)$r.squared, summary(model5)$r.squared),\n  Adj_R_squared = c(summary(model4)$adj.r.squared, summary(model5)$adj.r.squared)\n)\n\nprint(model_comparison)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                Model      AIC R_squared Adj_R_squared\n1      Model 4 (Full) 3472.092 0.6792946     0.6777082\n2 Model 5 (No precip) 3470.717 0.6791304     0.6778089\n```\n\n\n:::\n\n```{.r .cell-code}\n# Final model summary\ncat(\"\\n=== FINAL MODEL SUMMARY ===\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n=== FINAL MODEL SUMMARY ===\n```\n\n\n:::\n\n```{.r .cell-code}\nsummary(model5)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = npp_cuberoot ~ log_age + biomass + temp + teb + \n    leaf, data = forest_transformed)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-4.1085 -0.5919  0.0019  0.6459  5.1261 \n\nCoefficients:\n              Estimate Std. Error t value Pr(>|t|)    \n(Intercept)  1.396e+01  2.532e-01  55.120  < 2e-16 ***\nlog_age     -3.159e+00  1.465e-01 -21.559  < 2e-16 ***\nbiomass      1.040e-04  3.306e-06  31.465  < 2e-16 ***\ntemp         4.719e-02  5.658e-03   8.342  < 2e-16 ***\nteb         -1.296e-02  3.064e-03  -4.231  2.5e-05 ***\nleafneedle  -1.040e+00  6.150e-02 -16.910  < 2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 1 on 1214 degrees of freedom\nMultiple R-squared:  0.6791,\tAdjusted R-squared:  0.6778 \nF-statistic: 513.9 on 5 and 1214 DF,  p-value: < 2.2e-16\n```\n\n\n:::\n:::\n\n\n\n\n\n\n\n\n\n\n### Model Performance and Interpretation\n\n\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Get tidy summary of final model\nfinal_summary <- tidy(model5, conf.int = TRUE)\n\n# Get tidy summary of final model\nsummary(model5, conf.int = TRUE)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = npp_cuberoot ~ log_age + biomass + temp + teb + \n    leaf, data = forest_transformed)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-4.1085 -0.5919  0.0019  0.6459  5.1261 \n\nCoefficients:\n              Estimate Std. Error t value Pr(>|t|)    \n(Intercept)  1.396e+01  2.532e-01  55.120  < 2e-16 ***\nlog_age     -3.159e+00  1.465e-01 -21.559  < 2e-16 ***\nbiomass      1.040e-04  3.306e-06  31.465  < 2e-16 ***\ntemp         4.719e-02  5.658e-03   8.342  < 2e-16 ***\nteb         -1.296e-02  3.064e-03  -4.231  2.5e-05 ***\nleafneedle  -1.040e+00  6.150e-02 -16.910  < 2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 1 on 1214 degrees of freedom\nMultiple R-squared:  0.6791,\tAdjusted R-squared:  0.6778 \nF-statistic: 513.9 on 5 and 1214 DF,  p-value: < 2.2e-16\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Calculate partial R-squared for each variable\n# Using the sensemakr package equivalent or manual calculation\nanova_table <- anova(model5)\nprint(\"ANOVA Table:\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"ANOVA Table:\"\n```\n\n\n:::\n\n```{.r .cell-code}\nprint(anova_table)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nAnalysis of Variance Table\n\nResponse: npp_cuberoot\n            Df  Sum Sq Mean Sq  F value    Pr(>F)    \nlog_age      1  193.32  193.32  193.239 < 2.2e-16 ***\nbiomass      1 1886.95 1886.95 1886.142 < 2.2e-16 ***\ntemp         1  179.34  179.34  179.264 < 2.2e-16 ***\nteb          1   24.88   24.88   24.866 7.038e-07 ***\nleaf         1  286.08  286.08  285.957 < 2.2e-16 ***\nResiduals 1214 1214.52    1.00                       \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create coefficient plot\nfinal_summary %>%\n  filter(term != \"(Intercept)\") %>%\n  mutate(term = fct_reorder(term, estimate)) %>%\n  ggplot(aes(x = estimate, y = term)) +\n  geom_vline(xintercept = 0, linetype = \"dashed\", color = \"gray\") +\n  geom_point(size = 3) +\n  geom_errorbarh(aes(xmin = conf.low, xmax = conf.high), height = 0.2) +\n  labs(\n    title = \"Final Model Coefficients with 95% Confidence Intervals\",\n    x = \"Coefficient Estimate\",\n    y = \"Variables\"\n  ) +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](11_02_class_activity_files/figure-docx/final_summary_plot-1.png)\n:::\n:::\n\n\n\n\n\n\n\n\n\n\n## 6. Alternative Approach: Standardized Variables\n\nFollowing the original analysis, let's also try the standardized\napproach:\n\n\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create standardized variables\nforest_standardized <- forest_clean %>%\n  mutate(\n    npp_sqrt_scaled = scale(sqrt(npp))[,1],\n    log_age_scaled = scale(log10(age))[,1],\n    biomass_scaled = scale(biomass)[,1],\n    temp_scaled = scale(temp)[,1],\n    precip_scaled = scale(precip)[,1],\n    teb_scaled = scale(teb)[,1]\n  )\n\n# Standardized model\nmodel_std <- lm(npp_sqrt_scaled ~ log_age_scaled + biomass_scaled + \n                temp_scaled * precip_scaled + teb_scaled, \n                data = forest_standardized)\n\n# Summary\nsummary(model_std)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = npp_sqrt_scaled ~ log_age_scaled + biomass_scaled + \n    temp_scaled * precip_scaled + teb_scaled, data = forest_standardized)\n\nResiduals:\n     Min       1Q   Median       3Q      Max \n-3.14438 -0.38836 -0.03068  0.39178  3.01216 \n\nCoefficients:\n                           Estimate Std. Error t value Pr(>|t|)    \n(Intercept)               -0.064952   0.020075  -3.235 0.001247 ** \nlog_age_scaled            -0.543699   0.024500 -22.192  < 2e-16 ***\nbiomass_scaled             0.691415   0.025313  27.315  < 2e-16 ***\ntemp_scaled                0.215693   0.023304   9.256  < 2e-16 ***\nprecip_scaled             -0.008188   0.028714  -0.285 0.775563    \nteb_scaled                -0.071775   0.018879  -3.802 0.000151 ***\ntemp_scaled:precip_scaled  0.112727   0.017068   6.605 5.94e-11 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 0.6113 on 1213 degrees of freedom\nMultiple R-squared:  0.6281,\tAdjusted R-squared:  0.6263 \nF-statistic: 341.5 on 6 and 1213 DF,  p-value: < 2.2e-16\n```\n\n\n:::\n:::\n\n\n\n\n\n\n\n\n\n\n## 7. Key Findings and Conclusions\n\n\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create a summary of key findings\ncat(\"=== KEY FINDINGS ===\\n\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n=== KEY FINDINGS ===\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"1. MULTICOLLINEARITY:\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n1. MULTICOLLINEARITY:\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"   - Growing season length and temperature were highly correlated\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   - Growing season length and temperature were highly correlated\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"   - Removed growing season to address multicollinearity\\n\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   - Removed growing season to address multicollinearity\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"2. VARIABLE TRANSFORMATIONS:\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n2. VARIABLE TRANSFORMATIONS:\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"   - Log transformation of age improved model fit\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   - Log transformation of age improved model fit\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"   - Cube root transformation of npp addressed assumption violations\\n\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   - Cube root transformation of npp addressed assumption violations\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"3. FINAL MODEL RESULTS:\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n3. FINAL MODEL RESULTS:\n```\n\n\n:::\n\n```{.r .cell-code}\nfinal_r2 <- summary(model5)$r.squared\ncat(\"   - R-squared:\", round(final_r2, 3), \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   - R-squared: 0.679 \n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"   - Significant predictors: age (negative), biomass (positive), temp (positive)\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   - Significant predictors: age (negative), biomass (positive), temp (positive)\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"   - teb had negative effect, Leaf type differences were significant\\n\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   - teb had negative effect, Leaf type differences were significant\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"4. BIOLOGICAL INTERPRETATION:\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n4. BIOLOGICAL INTERPRETATION:\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"   - Younger stands had higher npp (for given biomass)\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   - Younger stands had higher npp (for given biomass)\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"   - Higher biomass associated with higher npp\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   - Higher biomass associated with higher npp\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"   - temp positively related to npp\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   - temp positively related to npp\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"   - Coniferous forests had lower npp than broadleaf forests\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   - Coniferous forests had lower npp than broadleaf forests\n```\n\n\n:::\n:::\n\n\n\n\n\n\n\n\n\n\n## References and Additional Notes\n\nThis analysis is based on:\n\n-   **Michaletz, S.T., Cheng, D., Kerkhoff, A.J. & Enquist, B.J.**\n    (2014). Convergence of terrestrial plant production across global\n    climate gradients. *Nature*, 512, 39-43.\n\n**Key Learning Points:** 1. **Multicollinearity Detection**: Use VIF\nvalues and correlation matrices 2. **Variable Transformations**: Log and\npower transformations can improve model fit 3. **Model Diagnostics**:\nAlways check residual plots and assumption violations 4. **Model\nComparison**: Use AIC and other criteria for model selection 5.\n**Interpretation**: Focus on biologically meaningful relationships\n\n**Modern R Practices Used:** - `tidyverse` for data manipulation and\nvisualization - `broom` for tidy model outputs - `car` for regression\ndiagnostics - `ggplot2` for modern visualizations - Pipe operators\n(`%>%`) for readable code - Tidy data principles throughout\n\n\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Session information for reproducibility\nsessionInfo()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nR version 4.5.0 (2025-04-11)\nPlatform: aarch64-apple-darwin20\nRunning under: macOS Sequoia 15.5\n\nMatrix products: default\nBLAS:   /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/lib/libRblas.0.dylib \nLAPACK: /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/lib/libRlapack.dylib;  LAPACK version 3.12.1\n\nlocale:\n[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8\n\ntime zone: America/Chicago\ntzcode source: internal\n\nattached base packages:\n[1] stats     graphics  grDevices utils     datasets  methods   base     \n\nother attached packages:\n [1] see_0.11.0         performance_0.14.0 broom_1.0.8        GGally_2.2.1      \n [5] corrplot_0.95      car_3.1-3          carData_3.0-5      lubridate_1.9.4   \n [9] forcats_1.0.0      stringr_1.5.1      dplyr_1.1.4        purrr_1.0.4       \n[13] readr_2.1.5        tidyr_1.3.1        tibble_3.2.1       ggplot2_3.5.2     \n[17] tidyverse_2.0.0   \n\nloaded via a namespace (and not attached):\n [1] gtable_0.3.6       xfun_0.52          insight_1.3.0      lattice_0.22-7    \n [5] tzdb_0.5.0         vctrs_0.6.5        tools_4.5.0        generics_0.1.4    \n [9] parallel_4.5.0     pkgconfig_2.0.3    Matrix_1.7-3       RColorBrewer_1.1-3\n[13] lifecycle_1.0.4    compiler_4.5.0     farver_2.1.2       codetools_0.2-20  \n[17] htmltools_0.5.8.1  yaml_2.3.10        Formula_1.2-5      pillar_1.10.2     \n[21] crayon_1.5.3       abind_1.4-8        nlme_3.1-168       ggstats_0.9.0     \n[25] tidyselect_1.2.1   digest_0.6.37      stringi_1.8.7      labeling_0.4.3    \n[29] splines_4.5.0      fastmap_1.2.0      grid_4.5.0         cli_3.6.5         \n[33] magrittr_2.0.3     utf8_1.2.5         withr_3.0.2        scales_1.4.0      \n[37] backports_1.5.0    bit64_4.6.0-1      timechange_0.3.0   rmarkdown_2.29    \n[41] bit_4.6.0          hms_1.1.3          evaluate_1.0.3     knitr_1.50        \n[45] mgcv_1.9-3         rlang_1.1.6        Rcpp_1.0.14        glue_1.8.0        \n[49] rstudioapi_0.17.1  vroom_1.6.5        jsonlite_2.0.0     R6_2.6.1          \n[53] plyr_1.8.9        \n```\n\n\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": null,
    "postProcess": false
  }
}