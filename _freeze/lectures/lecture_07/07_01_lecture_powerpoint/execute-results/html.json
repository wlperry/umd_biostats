{
  "hash": "8fe0375590efa80ce2a5d17c9eae1084",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Lecture 07 H testing and simple tests II\"\nauthor: \"Bill Perry\"\nexecute:\n  freeze: auto\n  cache: true\n  echo: true\n  keep-md: true # retains the images when you start again\n  message: false\n  warning: false\n  fig-height: 3\n  fig-width: 3\n  paged-print: false\nformat:\n  html:\n    toc: false\n    output-file: \"07_01_lecture_powerpoint_html.html\"\n    embed-resources: true\n    self-contained: true\n    max-width: 80ch # Limits line length to approximately 80 characters\n    css: ../../css/lecture.css\n  revealjs:\n    output-file: \"07_01_lecture_powerpoint_slides.html\"\n    self-contained: true\n    css: ../../css/lecture.css\n    slide-number: true\n    transition: fade\n  docx:\n    default: true\n    toc: false\n    toc-depth: 3\n    number-sections: false\n    highlight-style: github\n    reference-doc: ../../ms_templates/custom-reference.docx\n    css: msword.css\n    embed-resources: true\n  pptx:\n    reference-doc: ../../ms_templates/lecture_template.pptx\n    embed-resources: true\neditor: visual\n---\n\n\n\n\n\n\n\n\n\n\n# Lecture 6 - A Brief review\n\n::::: columns\n::: {.column width=\"60%\"}\n-   Hypotheses\n-   1- and 2-sided T tests\n-   **Assumptions of parametric tests**\n:::\n\n::: {.column width=\"40%\"}\n![](images/pine_needles.jpg){width=\"300\"}\n:::\n:::::\n\n# Lecture 7 overview\n\n::::: columns\n::: {.column width=\"60%\"}\nWhat we will cover today:\n\n-   What are the assumptions again and how do you assess them\n-   What to do when assumptions fail\n    -   Robust tests\n    -   Rank-based tests\n    -   Permutation tests\n:::\n\n::: {.column width=\"40%\"}\nLets work with the Lake Trout data as the weights are pretty cool and the assumptions may or may not hold\n\nThis is easily translated into any of the other dataframes you might want to use\n\nlake trout\n\n![](images/lake_trout.jpg){width=\"318\"}\n:::\n:::::\n\n\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Install packages if needed (uncomment if necessary)\n# install.packages(\"readr\")\n# install.packages(\"tidyverse\")\n# install.packages(\"car\")\n# install.packages(\"here\")\n\n# Load libraries\nlibrary(car)          # For diagnostic tests\nlibrary(patchwork)\nlibrary(tidyverse)    # For data manipulation and visualization\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# the stuff above controls the output and is also set at the top so dont need here\n# Load the pine needle data\n# Use here() function to specify the path\nlt_df <- read_csv(\"data/lake_trout.csv\")\n\n# Examine the first few rows\nhead(df)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                                              \n1 function (x, df1, df2, ncp, log = FALSE)    \n2 {                                           \n3     if (missing(ncp))                       \n4         .Call(C_df, x, df1, df2, log)       \n5     else .Call(C_dnf, x, df1, df2, ncp, log)\n6 }                                           \n```\n\n\n:::\n:::\n\n\n\n\n\n\n\n\n\n\n# Parametric versus non-parametric tests\n\n::::: columns\n::: {.column width=\"60%\"}\nT-tests are **parametric** tests\n\n-   Parametric tests:\n    -   specify/assume probability distribution from which parameters came\n    -   Basic assumptions of parametric t-tests:\n        -   Random sampling\n\n        -   Normality\n\n        -   Equal variance\n\n        -   No outliers\n-   Non-parametric tests: no assumption about probability distribution\n    -   Mukasa et al 2021 DOI: 10.4236/ojbm.2021.93081\n:::\n\n::: {.column width=\"40%\"}\n![](images/clipboard-2948249782.png){width=\"800\"}\n:::\n:::::\n\n# Assumptions of parametric tests\n\n::::: columns\n::: {.column width=\"60%\"}\n-   If assumptions of parametric test violated, test becomes unreliable\n-   This is because test statistic may no longer follow distribution\n-   Most parametric tests robust to mild/moderate violations of below assumptions\n:::\n\n::: {.column width=\"40%\"}\n![](images/clipboard-286482702.png){width=\"324\"}\n:::\n:::::\n\n# Assumptions of parametric tests\n\n::::: columns\n::: {.column width=\"60%\"}\n-   Basic assumptions of parametric t-tests:\n\n    -   Random sampling\n\n    -   Normality\n\n    -   Equal variance\n\n    -   No outliers\n\n-   Random sampling:\n\n    -   samples are randomly collected from populations; part of experimental design\n\n    -   Necessary for sample -\\> population inference\n:::\n\n::: {.column width=\"40%\"}\n\\<![](images/clipboard-2526616735.png){width=\"214\"}\\>\n:::\n:::::\n\n# Assumptions of parametric tests\n\n::::: columns\n::: {.column width=\"60%\"}\nBasic assumptions of parametric t-tests:\n\n-   Normality\n-   equal variance\n-   random sampling\n-   no outliers\n\n<!-- -->\n\n-   Lets do the above for one lake - `NE 12` as if we were going to do a one sample T Test\n    -   we need to make a new dataframae with NE 12 data only called `ne12_data`\n    -   how do you do this?\n\n<!-- -->\n\n-   Normality: Samples from normally distributed population\n    -   Graphical tests: histograms, dotplots, boxplots, **qq-plots**\n    -   \"Formal\" tests: **Shapiro-Wilk test** - sometimes not useful\n:::\n\n::: {.column width=\"40%\"}\n\n\n\n\n\n\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](07_01_lecture_powerpoint_files/figure-html/unnamed-chunk-2-1.png){width=480}\n:::\n:::\n\n\n\n\n\n\n\n\n\n:::\n:::::\n\n# Assumptions of parametric tests\n\n::::: columns\n::: {.column width=\"60%\"}\nBasic assumptions of parametric t-tests:\n\n-   Normality\n-   equal variance\n-   random sampling\n-   no outliers\n\n<!-- -->\n\n-   Lets do the above for one lake - `NE 12` as if we were going to do a one sample T Test\n    -   we need to make a new dataframae with NE 12 data only called `ne12_data`\n    -   how do you do this?\n\n<!-- -->\n\n-   Normality: Samples from normally distributed population\n    -   Graphical tests: histograms, dotplots, boxplots, **qq-plots**\n    -   \"Formal\" tests: **Shapiro-Wilk test** - sometimes not useful\n:::\n\n::: {.column width=\"40%\"}\n\n\n\n\n\n\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"Null hypothesis is that data is normally distributed\"\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tShapiro-Wilk normality test\n\ndata:  ne12_data$length_mm\nW = 0.94528, p-value = 1.56e-09\n```\n\n\n:::\n:::\n\n\n\n\n\n\n\n\n\n:::\n:::::\n\n# Assumptions of parametric tests\n\n::::: columns\n::: {.column width=\"60%\"}\nBasic assumptions of parametric t-tests:\n\n-   Normality\n-   equal variance\n-   random sampling\n-   no outliers\n\nEqual variance: samples are from populations with similar degree of variability\n\n-   Graphical tests: boxplots\n-   \"Formal\" tests: F-ratio test\n-   When samples sizes equal\n    -   Parametric tests most robust to violations of normality\n    -   Less so for equal variation assumptions\n:::\n\n::: {.column width=\"40%\"}\n\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlength_plot <- ne12_data %>% ggplot(aes(x=lake, y = length_mm)) +geom_boxplot() \nmass_plot <- ne12_data %>% ggplot(aes(x=lake, y = mass_g)) +geom_boxplot()\nlength_plot + mass_plot + plot_layout(ncol=1)\n```\n\n::: {.cell-output-display}\n![](07_01_lecture_powerpoint_files/figure-html/unnamed-chunk-4-1.png){width=288}\n:::\n:::\n\n\n\n\n\n\n\n\n\n:::\n:::::\n\n# Assumptions of parametric tests\n\n::::: columns\n::: {.column width=\"60%\"}\n-   Basic assumptions of parametric t-tests: - Normality\n\n```         \n-   equal variance\n\n-   random sampling\n\n-   no outliers\n```\n\n-   No outliers: no \"extreme\" values that are very different from rest of sample\n    -   Graphical tests: boxplots, histograms\n    -   \"Formal tests\": Grubb's test - no one really does this\n    -   **Note: outliers a problem for non-parametric tests as well**\n:::\n\n::: {.column width=\"40%\"}\n\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nne12_histo_plot + ne12_box_plot + plot_layout(ncol = 1)\n```\n\n::: {.cell-output-display}\n![](07_01_lecture_powerpoint_files/figure-html/unnamed-chunk-5-1.png){width=288}\n:::\n:::\n\n\n\n\n\n\n\n\n\n:::\n:::::\n\n# Nonparametric test\n\n::::: columns\n::: {.column width=\"60%\"}\n-   What if T Test assumptions fail?\n-   Alternative tests, with more relaxed assumptions, are available\n-   In which case would you use the following tests?\n    -   Welch's t-test: *when distribution normal but variance unequal*\n    -   Mann-Whitney-Wilcoxon test: *when distribution not normal and/or outliers are present (but both groups should still have similar distributions and \\~equal variance)*\n    -   Permutation test for two samples: *when distribution not normal (but both groups should still have similar distributions and \\~equal variance)*\n:::\n\n::: {.column width=\"40%\"}\n\\< --\n\n\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nne12_histo_plot+ne12_box_plot + ne12_qq_plot + plot_layout(ncol=1)\n```\n\n::: {.cell-output-display}\n![](07_01_lecture_powerpoint_files/figure-html/unnamed-chunk-6-1.png){width=288}\n:::\n:::\n\n\n\n\n\n\n\n\n\n:::\n:::::\n\n# Assumptions of parametric tests\n\n::::: columns\n::: {.column width=\"60%\"}\n-   QQ-plots: tool for assessing normality\n    -   On x- theoretical quantiles from SND\n    -   On y- ordered sample values\n    -   Deviation from normal can be detected as deviation from straight line\n:::\n\n::: {.column width=\"40%\"}\n<!-- -->\n\n\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nisl_ne12_df <- lt_df %>% filter(lake %in% c(\"NE 12\", \"Island Lake\"))\n\nne12_island_box_plot <- isl_ne12_df %>% \n  ggplot(aes(x=lake, y = mass_g, color=lake)) +\n  geom_boxplot()+\n  theme_minimal()\n# ne12_island_box_plot\n\nne12_island_qq_plot <- isl_ne12_df %>% \n  # filter(lake ==\"NE 12\") %>%\n  ggplot(aes(sample = mass_g , color=lake)) +\n  stat_qq() +\n  stat_qq_line() +\n  labs( x = \"Theoretical Quantiles\", y = \"Sample Quantiles\") +\n  theme_minimal() \n\nne12_island_box_plot +ne12_island_qq_plot+plot_layout(guides=\"collect\")\n```\n\n::: {.cell-output-display}\n![](07_01_lecture_powerpoint_files/figure-html/unnamed-chunk-7-1.png){width=288}\n:::\n:::\n\n\n\n\n\n\n\n\n\n:::\n:::::\n\n# Assumptions of parametric tests\n\n::::: columns\n::: {.column width=\"60%\"}\n-   In some cases, data can be mathematically \"transformed\" to meet assumptions of parametric tests\n-   this can be done in r and usually involves\n    -   log10 transformations\n    -   square root transformations\n    -   and many others... I will have a description soon\n:::\n\n::: {.column width=\"40%\"}\n\\<![](images/transformations_2%20jpg.jpg){width=\"419\"}\\>\n\n[source](https://www.elsblog.org/the_empirical_legal_studi/2006/08/variable_transf.html)\n:::\n:::::\n\n# Robust tests\n\n::::: columns\n::: {.column width=\"60%\"}\n-   **Welch's t-test**\n    -   common \"robust\" test for means of two populations\n    -   Robust to violation of equal variance assumption, deals better with unequal sample size\n    -   Parametric test (assumes normal distribution)\n    -   Calculates a t statistic but recalculates df based on samples sizes and s\n:::\n\n::: {.column width=\"40%\"}\n\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlog_ne12_island_box_plot <- isl_ne12_df %>% \n  ggplot(aes(x=lake, y = log10(mass_g), color=lake)) +\n  geom_boxplot()+\n  theme_minimal()\n\n\nne12_island_box_plot +log_ne12_island_box_plot +plot_layout(guides=\"collect\")\n```\n\n::: {.cell-output-display}\n![](07_01_lecture_powerpoint_files/figure-html/unnamed-chunk-8-1.png){width=288}\n:::\n:::\n\n\n\n\n\n\n\n\n\n:::\n:::::\n\n# Robust tests\n\n::::: columns\n::: {.column width=\"60%\"}\n-   \n\n-   **Lets compare a parametric T-Test to a Welch's t-test**\n\n    -   T-Test is:\n        -   **t.test(y1, y2, var.equal = TRUE, paired = FALSE)**\n    -   Welch's T-Test is:\n        -   **t.test(y1, y2, var.equal = FALSE, paired = FALSE)**\n:::\n\n::: {.column width=\"40%\"}\n\n\n\n\n\n\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"Standard t-test results for lenght_mm:\"\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tTwo Sample t-test\n\ndata:  mass_g by lake\nt = 14.181, df = 330, p-value < 2.2e-16\nalternative hypothesis: true difference in means between group Island Lake and group NE 12 is not equal to 0\n95 percent confidence interval:\n 2266.304 2996.360\nsample estimates:\nmean in group Island Lake       mean in group NE 12 \n                3165.0000                  533.6677 \n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"Welch's t-test results for lenght_mm:\"\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tWelch Two Sample t-test\n\ndata:  mass_g by lake\nt = 5.1368, df = 9.0578, p-value = 0.0006016\nalternative hypothesis: true difference in means between group Island Lake and group NE 12 is not equal to 0\n95 percent confidence interval:\n 1473.676 3788.989\nsample estimates:\nmean in group Island Lake       mean in group NE 12 \n                3165.0000                  533.6677 \n```\n\n\n:::\n:::\n\n\n\n\n\n\n\n\n\n:::\n:::::\n\n# Rank based tests\n\n::::: columns\n::: {.column width=\"60%\"}\nRank-based tests: no assumptions about distribution (non-parametric)\n\n-   Ranks of data: observations assigned ranks, sums (and signs for paired tests) of ranks for groups compared\n\n-   **Mann-Whitney U test** common alternative to independent samples t-test\n\n-   **Wilcoxon signed-rank** test is alternative to paired t-test\n\n<!-- -->\n\n-   Assumptions: similar distributions for groups, equal variance\n-   Less power than parametric tests\n-   Best when normality assumption can not be met by transformation (weird distribution) or large outliers\n:::\n\n::: {.column width=\"40%\"}\n\\<\n\n\n\n\n\n\n\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"Mann-Whitney U test results length:\"\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tWilcoxon rank sum test with continuity correction\n\ndata:  mass_g by lake\nW = 3205.5, p-value = 9.506e-08\nalternative hypothesis: true location shift is not equal to 0\n```\n\n\n:::\n:::\n\n\n\n\n\n\n\n\n\n:::\n:::::\n\n# \n\n# Permutation tests\n\n::::: columns\n::: {.column width=\"60%\"}\n-   Permutation tests based on resampling: reshuffling of original data\n-   Resampling allows parameter estimation when distribution unknown, including SEs and CIs of statistics (means, medians)\n-   Common approach is bootstrap: resample sample with replacement many times, recalculate sample stats\n-   Use the `perm` package\n\n  -   Ho: µ~A~ = µ~B~    \n  -   Ha: µ~A~ ≠µ~B~    \n  \n-   Calculates the difference ∆ in means between two groups\n:::\n\n::: {.column width=\"40%\"}\n\\<!\n\n\n\n\n\n\n\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](07_01_lecture_powerpoint_files/figure-html/unnamed-chunk-11-1.png){width=288}\n:::\n:::\n\n\n\n\n\n\n\n\n\n:::\n:::::\n\n# Permutation tests\n\n::::: columns\n::: {.column width=\"60%\"}\n-   Randomly reshuffle observations between groups (keeping n~NE 12~=323 and n~Island~=10), calculate ∆\n-   Repeat \\>1,000 times\n-   Record proportion of the different means i\n-   This is equivalent to p-value and can be used in \"traditional\" H test framework\n-   For a graphical explanation:\n    -   [Graphical Explanation](https://www.jwilber.me/permutationtest/)\n:::\n\n::: {.column width=\"40%\"}\n:::\n:::::\n\n# Permutation tests\n\n-   In R (using 'perm' package):\n-   Assumptions: both groups have similar distribution; equal variance\n\n\n\n\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(perm) \n\n# Prepare data for permutation test\nne12_perm_data <- isl_ne12_df %>% \n  filter(lake == \"NE 12\") %>% \n  pull(length_mm)\n\n# Randomly sample exactly 25 observations from NE 12 (set seed for reproducibility)\nset.seed(123)\nne12_perm_data <- sample(ne12_perm_data, size = 25, replace = FALSE)\n\nisland_perm_data <- isl_ne12_df %>% \n  filter(lake == \"Island Lake\") %>% \n  pull(length_mm)\n\n# Calculate the observed difference in means\nobserved_diff <- mean(ne12_perm_data, na.rm = TRUE) - mean(island_perm_data, na.rm = TRUE)\n\n# Perform permutation test for difference in means using perm package\npermTS(ne12_perm_data, island_perm_data, \n       alternative = \"two.sided\", \n       method = \"exact.mc\", \n       control = permControl(nmc = 10000))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tExact Permutation Test Estimated by Monte Carlo\n\ndata:  GROUP 1 and GROUP 2\np-value = 2e-04\nalternative hypothesis: true mean GROUP 1 - mean GROUP 2 is not equal to 0\nsample estimates:\nmean GROUP 1 - mean GROUP 2 \n                    -333.08 \n\np-value estimated from 10000 Monte Carlo replications\n99 percent confidence interval on p-value:\n 0.000000000 0.001059383 \n```\n\n\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}