{
  "hash": "8693cd1cf0b8d9e447dc044a047293ca",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"08_Class_Activity\"\nauthor: \"Bill Perry\"\nexecute:\n  freeze: auto\n  cache: true\n  echo: true\n  keep-md: true # retains the images when you start again\n  fig-height: 3\n  fig-width: 3\n  paged-print: false\nformat:\n  html:\n    freeze: false\n    toc: false\n    output-file: \"08_02_class_activity.html\"\n    default: true\n    embed-resources: true\n    self-contained: true\n    max-width: 80ch  # Limits line length to approximately 80 characters\n    css: ../../css/activity.css\n  docx:\n    default: true\n    toc: false\n    toc-depth: 3\n    number-sections: false\n    highlight-style: github\n    reference-doc: ../../ms_templates/custom-reference.docx\n    css: msword.css\n    embed-resources: true\n---\n\n\n\n\n\n\n# In class activity 8: Study Design and Power Analysis  \n\n## Introduction\n\nThis document demonstrates key concepts in experimental design using ecological examples, focusing on:\n\n1.  **Formulating research questions**\n2.  **Understanding different study designs**\n3.  **Recognizing proper replication vs. pseudoreplication**\n4.  **Designing appropriate controls**\n5.  **Conducting power analysis** (a priori and post hoc)\n6.  **Planning sampling strategies**\n\nWe'll work with simulated pine needle data to practice these concepts.\n\nLet's start by exploring these concepts with hands-on examples!\n\n# **Part 1:** Load Required Packages\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load required packages\nlibrary(tidyverse)  # For data manipulation and visualization\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.4     ✔ readr     2.1.5\n✔ forcats   1.0.0     ✔ stringr   1.5.1\n✔ ggplot2   3.5.2     ✔ tibble    3.2.1\n✔ lubridate 1.9.4     ✔ tidyr     1.3.1\n✔ purrr     1.0.4     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(patchwork)  # For combining plots\nlibrary(pwr)        # For power analysis\n\n# Set seed for reproducible results\nset.seed(42)\n```\n:::\n\n\n\n\n\n\n::: callout-tip\n## Package Overview\n\n-   **tidyverse**: Collection of packages for data science (includes ggplot2, dplyr, etc.)\n-   **patchwork**: Easily combine multiple ggplot2 plots\n-   **pwr**: Functions for power analysis and sample size calculations\n:::\n\n# **Part 2:** Formulating Research Questions\n\nBefore we design any study, we need clear research questions. Let's practice with pine needle ecology.\n\n::: callout-important\n## Activity 1: Research Question Practice\n\nThink about pine trees on campus. Write down 2-3 specific research questions about:\n\n-   \\- Pine needle characteristics (length, density, color)\n\n-   \\- Environmental factors (wind, sunlight, soil)\n\n-   \\- Tree health or growth\n\n**Example questions:**\n\n-   \\- Does wind exposure affect pine needle length?\n-   \\- Do pine needles on south-facing branches differ from north-facing branches?\n-   \\- Does tree size influence needle density?\n\n**Your questions:**\n\n1.  1\\. \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\n\n2.  2\\. \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\n\n3.  3\\. \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\n:::\n\n# **Part 3:** Understanding Study Design Types\n\nLet's simulate data for different types of studies to understand their strengths and limitations.\n\n## Natural Experiment: Wind Exposure Study\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Simulate pine needle data from naturally exposed and sheltered locations\n# This represents a \"natural experiment\" - we didn't manipulate wind exposure\n\n# Create data for exposed locations (shorter needles due to wind stress)\nexposed_data <- data.frame(\n  location = rep(paste0(\"Exposed_\", 1:5), each = 8),\n  wind_exposure = \"exposed\",\n  needle_length_mm = rnorm(40, mean = 75, sd = 10),\n  tree_id = rep(1:5, each = 8)\n)\n\n# Create data for sheltered locations (longer needles, less wind stress)\nsheltered_data <- data.frame(\n  location = rep(paste0(\"Sheltered_\", 1:5), each = 8),\n  wind_exposure = \"sheltered\", \n  needle_length_mm = rnorm(40, mean = 90, sd = 12),\n  tree_id = rep(6:10, each = 8)\n)\n\n# Combine the datasets\nnatural_exp_data <- rbind(exposed_data, sheltered_data)\n\n# Look at the first few rows\nhead(natural_exp_data)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   location wind_exposure needle_length_mm tree_id\n1 Exposed_1       exposed         88.70958       1\n2 Exposed_1       exposed         69.35302       1\n3 Exposed_1       exposed         78.63128       1\n4 Exposed_1       exposed         81.32863       1\n5 Exposed_1       exposed         79.04268       1\n6 Exposed_1       exposed         73.93875       1\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Visualize the natural experiment data\nnatural_plot <- natural_exp_data %>% \n  ggplot(aes(x = wind_exposure, y = needle_length_mm, fill = wind_exposure)) +\n  geom_boxplot(alpha = 0.7) +\n  geom_jitter(width = 0.2, alpha = 0.5) +\n  labs(title = \"Natural Experiment: Wind Exposure Effect\",\n       subtitle = \"Comparing naturally exposed vs. sheltered locations\",\n       x = \"Wind Exposure\",\n       y = \"Needle Length (mm)\") +\n  theme_minimal() +\n  theme(legend.position = \"none\")\n\nnatural_plot\n```\n\n::: {.cell-output-display}\n![](lecture_08_02_class_activity_files/figure-docx/unnamed-chunk-1-1.png)\n:::\n:::\n\n\n\n\n\n\n::: callout-note\n## Natural Experiments: Pros and Cons\n\n**Advantages:** - Realistic conditions - Large scale possible - Cost-effective\n\n**Disadvantages:** - Cannot control confounding variables - Cannot determine causation direction - Many unmeasured factors might influence results\n\n**Question:** What other factors besides wind might differ between \"exposed\" and \"sheltered\" locations?\n:::\n\n## Manipulative Experiment: Controlled Wind Study\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Simulate a controlled experiment where we manipulate wind exposure\n# All trees start similar, then we apply treatments\n\n# Create data for control group (normal conditions)\ncontrol_data <- data.frame(\n  treatment = \"control\",\n  needle_length_mm = rnorm(25, mean = 85, sd = 8),\n  tree_id = 1:25\n)\n\n# Create data for wind treatment (artificial wind exposure)\nwind_treatment_data <- data.frame(\n  treatment = \"wind_treatment\",\n  needle_length_mm = rnorm(25, mean = 78, sd = 8),\n  tree_id = 26:50\n)\n\n# Combine the datasets\nmanipulative_data <- rbind(control_data, wind_treatment_data)\n\n# Visualize the manipulative experiment\nmanipulative_plot <- manipulative_data %>% \n  ggplot(aes(x = treatment, y = needle_length_mm, fill = treatment)) +\n  geom_boxplot(alpha = 0.7) +\n  geom_jitter(width = 0.2, alpha = 0.5) +\n  labs(title = \"Manipulative Experiment: Controlled Wind Treatment\",\n       subtitle = \"Randomly assigned trees to control vs. wind treatment\",\n       x = \"Treatment\",\n       y = \"Needle Length (mm)\") +\n  theme_minimal() +\n  theme(legend.position = \"none\")\n\nmanipulative_plot\n```\n\n::: {.cell-output-display}\n![](lecture_08_02_class_activity_files/figure-docx/manipulative_experiment-1.png)\n:::\n:::\n\n\n\n\n\n\n::: callout-tip\n## Manipulative Experiments: Key Features\n\n**Advantages:** - Can establish causation - Control confounding variables - Random assignment eliminates bias\n\n**Disadvantages:** - Often smaller scale - May not reflect natural conditions - Can be expensive and logistically challenging\n\n**Key Question:** Which experiment gives stronger evidence for causation?\n:::\n\n# **Part 4:** Identifying Proper Replication\n\nOne of the most common mistakes in ecological studies is pseudoreplication. Let's practice identifying true replication vs. pseudoreplication.\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Example 1: Pseudoreplication - multiple measurements from same trees\npseudo_data <- data.frame(\n  treatment = rep(c(\"fertilized\", \"control\"), each = 20),\n  tree_id = rep(c(\"Tree_A\", \"Tree_B\"), each = 20),  # Only 2 trees total!\n  needle_length_mm = c(\n    rnorm(20, mean = 95, sd = 5),  # Tree A (fertilized)\n    rnorm(20, mean = 80, sd = 5)   # Tree B (control)\n  ),\n  measurement = rep(1:20, times = 2)\n)\n\n# Example 2: True replication - multiple trees per treatment\ntrue_rep_data <- data.frame(\n  treatment = rep(c(\"fertilized\", \"control\"), each = 20),\n  tree_id = paste0(\"Tree_\", 1:40),  # 40 different trees\n  needle_length_mm = c(\n    rnorm(20, mean = 95, sd = 8),  # 20 fertilized trees\n    rnorm(20, mean = 80, sd = 8)   # 20 control trees\n  )\n)\n\n# Create comparison plots\npseudo_plot <- pseudo_data %>%\n  ggplot(aes(x = treatment, y = needle_length_mm, fill = treatment)) +\n  geom_boxplot() +\n  labs(title = \"Pseudoreplication\",\n       subtitle = \"Multiple needles from only 2 trees\",\n       x = \"Treatment\", y = \"Needle Length (mm)\") +\n  theme_minimal() +\n  theme(legend.position = \"none\")\n\ntrue_plot <- true_rep_data %>%\n  ggplot(aes(x = treatment, y = needle_length_mm, fill = treatment)) +\n  geom_boxplot() +\n  labs(title = \"True Replication\", \n       subtitle = \"Multiple trees per treatment\",\n       x = \"Treatment\", y = \"Needle Length (mm)\") +\n  theme_minimal() +\n  theme(legend.position = \"none\")\n\n# Combine plots\npseudo_plot + true_plot\n```\n\n::: {.cell-output-display}\n![](lecture_08_02_class_activity_files/figure-docx/pseudoreplication_examples-1.png)\n:::\n:::\n\n\n\n\n\n\n::: callout-warning\n## Pseudoreplication Alert!\n\n**Pseudoreplication occurs when:** - You treat subsamples as independent when they're not - Multiple measurements from the same experimental unit - Replication at wrong scale for your hypothesis\n\n**Common examples:** - Multiple leaves from one plant - Multiple water samples from one lake - Multiple plots within one treatment area\n\n**Why it's bad:** - Underestimates variability - Inflates sample size artificially - Increases Type I error (false positives)\n:::\n\n## Activity: Identify Replication Issues\n\n::: callout-important\n## Activity 2: Replication Practice\n\nFor each scenario, identify if there's proper replication or pseudoreplication:\n\n**Scenario A:** Testing fertilizer effects by using 1 large pot with fertilizer containing 10 pine seedlings, and 1 control pot with 10 seedlings. - **Your answer:** \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_ - **Fix:** \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\n\n**Scenario B:** Testing altitude effects by measuring needle length on 5 trees at 1000m elevation and 5 trees at 2000m elevation. - **Your answer:** \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_ - **Fix:** \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\n\n**Scenario C:** Testing soil pH by measuring 20 needles each from 10 trees in acidic soil and 10 trees in basic soil. - **Your answer:** \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_ - **Fix:** \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\n:::\n\n# **Part 5:** Power Analysis - Planning Your Study\n\nPower analysis helps us determine how many samples we need to detect an effect if it really exists.\n\n## A Priori Power Analysis (Before Data Collection)\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Scenario: We want to detect a difference in needle length between \n# fertilized and control trees\n\n# Based on pilot data, we expect:\ncontrol_mean <- 80      # mm\nfertilized_mean <- 90   # mm  \npooled_sd <- 12         # mm\n\n# Calculate effect size (Cohen's d)\neffect_size <- abs(fertilized_mean - control_mean) / pooled_sd\ncat(\"Effect size (Cohen's d):\", round(effect_size, 2), \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nEffect size (Cohen's d): 0.83 \n```\n\n\n:::\n\n```{.r .cell-code}\n# Interpret effect size\nif(effect_size < 0.2) {\n  interpretation <- \"small\"\n} else if(effect_size < 0.5) {\n  interpretation <- \"small-medium\" \n} else if(effect_size < 0.8) {\n  interpretation <- \"medium-large\"\n} else {\n  interpretation <- \"large\"\n}\ncat(\"This is a\", interpretation, \"effect size\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nThis is a large effect size\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Calculate required sample size for 80% power\npower_result <- pwr.t.test(\n  d = effect_size,           # Effect size\n  sig.level = 0.05,         # Alpha level (significance)\n  power = 0.8,              # Desired power (80%)\n  type = \"two.sample\"       # Two-sample t-test\n)\n\nprint(power_result)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n     Two-sample t test power calculation \n\n              n = 23.60467\n              d = 0.8333333\n      sig.level = 0.05\n          power = 0.8\n    alternative = two.sided\n\nNOTE: n is number in *each* group\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"\\nWe need\", ceiling(power_result$n), \"trees per group for 80% power\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nWe need 24 trees per group for 80% power\n```\n\n\n:::\n:::\n\n\n\n\n\n\n::: callout-tip\n## Understanding Effect Size (Cohen's d)\n\n-   **d = 0.2**: Small effect (subtle difference)\n-   **d = 0.5**: Medium effect (moderate difference)\n-   **d = 0.8**: Large effect (substantial difference)\n\n**Cohen's d formula:** d = (Mean₁ - Mean₂) / Pooled Standard Deviation\n:::\n\n## Visualizing Power Curves\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create a power curve showing relationship between sample size and power\nsample_sizes <- seq(5, 50, by = 2)\n\n# Calculate power for each sample size\npower_values <- sapply(sample_sizes, function(n) {\n  power_test <- pwr.t.test(n = n, d = effect_size, sig.level = 0.05, type = \"two.sample\")\n  return(power_test$power)\n})\n\n# Create data frame for plotting\npower_df <- data.frame(\n  sample_size = sample_sizes,\n  power = power_values\n)\n\n# Create power curve plot\npower_curve_plot <- ggplot(power_df, aes(x = sample_size, y = power)) +\n  geom_line(color = \"blue\", size = 1.2) +\n  geom_hline(yintercept = 0.8, linetype = \"dashed\", color = \"red\", size = 1) +\n  geom_vline(xintercept = ceiling(power_result$n), linetype = \"dashed\", color = \"red\", size = 1) +\n  annotate(\"text\", x = ceiling(power_result$n) + 5, y = 0.5, \n           label = paste(\"n =\", ceiling(power_result$n)), color = \"red\") +\n  annotate(\"text\", x = 35, y = 0.85, label = \"80% Power\", color = \"red\") +\n  ylim(0, 1) +\n  labs(title = \"Power Analysis: Sample Size vs. Statistical Power\",\n       subtitle = paste(\"Effect size (d) =\", round(effect_size, 2)),\n       x = \"Sample Size (per group)\",\n       y = \"Statistical Power\") +\n  theme_minimal()\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.\nℹ Please use `linewidth` instead.\n```\n\n\n:::\n\n```{.r .cell-code}\npower_curve_plot\n```\n\n::: {.cell-output-display}\n![](lecture_08_02_class_activity_files/figure-docx/power_curves-1.png)\n:::\n:::\n\n\n\n\n\n\n## Post Hoc Power Analysis (After Data Collection)\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Imagine we collected data with n = 15 per group but found no significant difference\n# Was our study adequately powered?\n\nobserved_n <- 15\n\n# Calculate the power we actually had\nactual_power <- pwr.t.test(\n  n = observed_n,\n  d = effect_size,\n  sig.level = 0.05,\n  type = \"two.sample\"\n)\n\nprint(actual_power)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n     Two-sample t test power calculation \n\n              n = 15\n              d = 0.8333333\n      sig.level = 0.05\n          power = 0.5962064\n    alternative = two.sided\n\nNOTE: n is number in *each* group\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"\\nWith n =\", observed_n, \"per group, we only had\", \n    round(actual_power$power * 100, 1), \"% power\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nWith n = 15 per group, we only had 59.6 % power\n```\n\n\n:::\n\n```{.r .cell-code}\nif(actual_power$power < 0.8) {\n  cat(\"This study was underpowered! A non-significant result might be due to insufficient sample size.\\n\")\n} else {\n  cat(\"This study had adequate power. A non-significant result likely reflects no true effect.\\n\")\n}\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nThis study was underpowered! A non-significant result might be due to insufficient sample size.\n```\n\n\n:::\n:::\n\n\n\n\n\n\n::: callout-important\n## Activity 3: Power Analysis Practice\n\n**Scenario:** You want to study the effect of drought stress on pine needle length. Based on literature, you expect: - Control trees: mean = 85mm, SD = 10mm\\\n- Drought-stressed trees: mean = 75mm, SD = 10mm\n\n**Calculate the following:**\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Your turn! Fill in the values and run the code\n\n# Step 1: Calculate effect size\ncontrol_mean <-     9\ndrought_mean <-     99  \npooled_sd <-        999\n\neffect_size <- abs(control_mean - drought_mean) / pooled_sd\nprint(paste(\"Effect size:\", round(effect_size, 2)))\n\n# Step 2: Calculate required sample size for 80% power\npower_result <- pwr.t.test(\n  d = effect_size,\n  sig.level = 0.05,\n  power = 0.8,\n  type = \"two.sample\"\n)\n\nprint(power_result)\nprint(paste(\"Required sample size:\", ceiling(power_result$n), \"trees per group\"))\n\n# Step 3: What if you can only collect 12 trees per group?\nlimited_power <- pwr.t.test(\n  n = 12,\n  d = effect_size, \n  sig.level = 0.05,\n  type = \"two.sample\"\n)\n\nprint(paste(\"Power with n=12:\", round(limited_power$power * 100, 1), \"%\"))\n```\n:::\n\n\n\n\n\n\n**Questions:** 1. What is the effect size for this drought study? 2. How many trees do you need per group for 80% power? 3. If you can only sample 12 trees per group, what power will you have?\n:::\n\n# **Part 6:** Sampling Design Strategies\n\nDifferent research questions require different sampling approaches. Let's explore the main types.\n\n## Simple Random Sampling\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Simulate a campus with pine trees scattered randomly\nset.seed(123)\ncampus_trees <- data.frame(\n  tree_id = 1:100,\n  x_coordinate = runif(100, 0, 100),  # Random x positions\n  y_coordinate = runif(100, 0, 100),  # Random y positions\n  needle_length = rnorm(100, mean = 80, sd = 12)\n)\n\n# Simple random sampling: select 20 trees randomly\nrandom_sample_ids <- sample(1:100, size = 20, replace = FALSE)\nrandom_sample <- campus_trees[campus_trees$tree_id %in% random_sample_ids, ]\n\n# Visualize sampling design\ncampus_plot <- ggplot(campus_trees, aes(x = x_coordinate, y = y_coordinate)) +\n  geom_point(color = \"lightgreen\", size = 2, alpha = 0.6) +\n  geom_point(data = random_sample, color = \"red\", size = 3) +\n  labs(title = \"Simple Random Sampling\",\n       subtitle = \"Red points = selected trees\",\n       x = \"X Coordinate\", y = \"Y Coordinate\") +\n  theme_minimal()\n\ncampus_plot\n```\n\n::: {.cell-output-display}\n![](lecture_08_02_class_activity_files/figure-docx/random_sampling-1.png)\n:::\n:::\n\n\n\n\n\n\n## Stratified Sampling\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Simulate campus with different zones (north vs south)\nset.seed(124)\nstratified_trees <- data.frame(\n  tree_id = 1:100,\n  x_coordinate = runif(100, 0, 100),\n  y_coordinate = runif(100, 0, 100),\n  zone = ifelse(runif(100) > 0.5, \"North\", \"South\"),\n  needle_length = rnorm(100, mean = 80, sd = 12)\n)\n\n# Add zone effect to needle length\nstratified_trees$needle_length[stratified_trees$zone == \"South\"] <- \n  stratified_trees$needle_length[stratified_trees$zone == \"South\"] + 8\n\n# Stratified sampling: sample equally from each zone\nnorth_trees <- stratified_trees[stratified_trees$zone == \"North\", ]\nsouth_trees <- stratified_trees[stratified_trees$zone == \"South\", ]\n\n# Sample 10 from each zone\nnorth_sample <- north_trees[sample(nrow(north_trees), 10), ]\nsouth_sample <- south_trees[sample(nrow(south_trees), 10), ]\nstratified_sample <- rbind(north_sample, south_sample)\n\n# Visualize stratified sampling\nstratified_plot <- ggplot(stratified_trees, aes(x = x_coordinate, y = y_coordinate, color = zone)) +\n  geom_point(size = 2, alpha = 0.6) +\n  geom_point(data = stratified_sample, size = 4, shape = 21, fill = \"yellow\", stroke = 2) +\n  labs(title = \"Stratified Sampling\",\n       subtitle = \"Yellow outline = selected trees, equal sampling from each zone\",\n       x = \"X Coordinate\", y = \"Y Coordinate\", color = \"Zone\") +\n  theme_minimal()\n\nstratified_plot\n```\n\n::: {.cell-output-display}\n![](lecture_08_02_class_activity_files/figure-docx/stratified_sampling-1.png)\n:::\n:::\n\n\n\n\n\n\n## Systematic Sampling\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Systematic sampling along a transect\nset.seed(125)\ntransect_trees <- data.frame(\n  tree_id = 1:50,\n  distance_m = seq(0, 490, by = 10),  # Trees every 10m along transect\n  needle_length = rnorm(50, mean = 80, sd = 10)\n)\n\n# Add distance effect (trees farther from road have longer needles)\ntransect_trees$needle_length <- transect_trees$needle_length + \n  (transect_trees$distance_m * 0.02)\n\n# Systematic sampling: every 5th tree\nsystematic_sample <- transect_trees[seq(1, 50, by = 5), ]\n\n# Visualize systematic sampling\nsystematic_plot <- ggplot(transect_trees, aes(x = distance_m, y = 1)) +\n  geom_point(size = 3, alpha = 0.6, color = \"lightblue\") +\n  geom_point(data = systematic_sample, size = 4, color = \"red\") +\n  labs(title = \"Systematic Sampling Along Transect\",\n       subtitle = \"Red points = selected trees (every 5th tree)\",\n       x = \"Distance from Road (m)\", y = \"\") +\n  theme_minimal() +\n  theme(axis.text.y = element_blank(), axis.ticks.y = element_blank()) +\n  ylim(0.5, 1.5)\n\nsystematic_plot\n```\n\n::: {.cell-output-display}\n![](lecture_08_02_class_activity_files/figure-docx/systematic_sampling-1.png)\n:::\n:::\n\n\n\n\n\n\n::: callout-note\n## Sampling Strategy Comparison\n\n**Simple Random Sampling:** - Best for: General population estimates - Pros: Unbiased, simple analysis - Cons: May miss important subgroups\n\n**Stratified Sampling:**\\\n- Best for: When you know there are distinct subgroups - Pros: Ensures representation of all strata - Cons: Requires prior knowledge of strata\n\n**Systematic Sampling:** - Best for: Studying gradients or patterns - Pros: Good spatial coverage, easy to implement - Cons: Risk of bias if there's hidden periodicity\n:::\n\n# **Part 7:** Putting It All Together - Design Your Own Study\n\n::: callout-important\n## Activity 4: Complete Study Design\n\n**Research Question:** Does fertilizer application affect pine needle length?\n\n**Design your study by answering these questions:**\n\n1.  **Study Type:** Will this be a natural experiment or manipulative experiment? Why?\n    -   Your answer: \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\n2.  **Sample Size:** Using the following parameters, calculate required sample size:\n    -   Expected control mean: 80mm\n    -   Expected fertilized mean: 88mm\\\n    -   Expected SD for both groups: 10mm\n    -   Desired power: 80%\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Calculate effect size and sample size needed\ncontrol_mean <- 80\nfertilized_mean <- 88\npooled_sd <- 10\n\neffect_size <- abs(fertilized_mean - control_mean) / pooled_sd\n\npower_result <- pwr.t.test(\n  d = effect_size,\n  sig.level = 0.05,\n  power = 0.8,\n  type = \"two.sample\"\n)\n\nprint(power_result)\n```\n:::\n\n\n\n\n\n\n3.  **Controls:** What controls will you include? Consider both positive and negative controls.\n    -   Your answer: \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\n4.  **Randomization:** How will you randomize tree assignment to treatments?\n    -   Your answer: \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\n5.  **Replication:** How will you ensure proper replication? What would be pseudoreplication?\n    -   Proper replication: \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\n    -   Pseudoreplication to avoid: \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\n6.  **Independence:** What factors might violate independence? How will you address them?\n    -   Your answer: \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\n7.  **Potential Confounds:** What other variables might affect needle length that you need to control for?\n    -   Your answer: \\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\\_\n:::\n\n# **Part 8:** Analyzing Your Designed Study\n\nLet's simulate data from the study you designed and analyze it:\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Simulate data based on your study design\nset.seed(200)\n\n# Use the sample size you calculated (or use 20 if you didn't calculate)\nn_per_group <- 20  # Replace with your calculated sample size\n\n# Create the experimental data\nstudy_data <- data.frame(\n  tree_id = 1:(2 * n_per_group),\n  treatment = rep(c(\"control\", \"fertilized\"), each = n_per_group),\n  needle_length_mm = c(\n    rnorm(n_per_group, mean = 80, sd = 10),  # Control group\n    rnorm(n_per_group, mean = 88, sd = 10)   # Fertilized group\n  )\n)\n\n# Calculate summary statistics\nsummary_stats <- study_data %>%\n  group_by(treatment) %>%\n  summarise(\n    n = n(),\n    mean_length = mean(needle_length_mm),\n    sd_length = sd(needle_length_mm),\n    se_length = sd_length / sqrt(n)\n  )\n\nprint(summary_stats)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 2 × 5\n  treatment      n mean_length sd_length se_length\n  <chr>      <int>       <dbl>     <dbl>     <dbl>\n1 control       20        79.3      7.85      1.76\n2 fertilized    20        87.4      8.57      1.92\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create visualization\nstudy_plot <- study_data %>%\n  ggplot(aes(x = treatment, y = needle_length_mm, fill = treatment)) +\n  geom_boxplot(alpha = 0.7) +\n  geom_jitter(width = 0.2, alpha = 0.6) +\n  stat_summary(fun = mean, geom = \"point\", shape = 23, size = 3, fill = \"white\") +\n  labs(title = \"Fertilizer Effect on Pine Needle Length\",\n       subtitle = \"White diamonds show group means\",\n       x = \"Treatment\",\n       y = \"Needle Length (mm)\") +\n  theme_minimal() +\n  theme(legend.position = \"none\")\n\nstudy_plot\n```\n\n::: {.cell-output-display}\n![](lecture_08_02_class_activity_files/figure-docx/unnamed-chunk-3-1.png)\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Conduct statistical test\nt_test_result <- t.test(needle_length_mm ~ treatment, data = study_data)\nprint(t_test_result)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n\tWelch Two Sample t-test\n\ndata:  needle_length_mm by treatment\nt = -3.1164, df = 37.715, p-value = 0.003493\nalternative hypothesis: true difference in means between group control and group fertilized is not equal to 0\n95 percent confidence interval:\n -13.364541  -2.837295\nsample estimates:\n   mean in group control mean in group fertilized \n                79.33243                 87.43335 \n```\n\n\n:::\n\n```{.r .cell-code}\n# Interpret results\nif(t_test_result$p.value < 0.05) {\n  cat(\"\\nResult: Significant difference found!\\n\")\n  cat(\"Fertilizer significantly affects needle length (p =\", \n      round(t_test_result$p.value, 4), \")\\n\")\n} else {\n  cat(\"\\nResult: No significant difference found.\\n\")\n  cat(\"No evidence that fertilizer affects needle length (p =\", \n      round(t_test_result$p.value, 4), \")\\n\")\n}\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nResult: Significant difference found!\nFertilizer significantly affects needle length (p = 0.0035 )\n```\n\n\n:::\n\n```{.r .cell-code}\n# Calculate actual effect size observed\nobserved_effect_size <- abs(diff(t_test_result$estimate)) / \n  sqrt(((n_per_group-1) * var(study_data$needle_length_mm[study_data$treatment == \"control\"]) + \n        (n_per_group-1) * var(study_data$needle_length_mm[study_data$treatment == \"fertilized\"])) / \n       (2*n_per_group - 2))\n\ncat(\"Observed effect size (Cohen's d):\", round(observed_effect_size, 2), \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nObserved effect size (Cohen's d): 0.99 \n```\n\n\n:::\n:::\n\n\n\n\n\n\n# **Summary and Key Takeaways**\n\n::: callout-tip\n## What We Learned Today\n\n1.  **Study Design Matters:** Statistics cannot fix a poorly designed study\n2.  **Replication:** Must be at the appropriate scale for your research question\n3.  **Controls:** Essential for ruling out alternative explanations\\\n4.  **Power Analysis:** Plan your sample size before collecting data\n5.  **Sampling Strategy:** Choose the approach that best fits your research question\n6.  **Integration:** Good analysis flows naturally from good design\n\n**Remember:** - Design before you collect data - Consider practical and logistical constraints - Be transparent about limitations - Correlation ≠ causation (especially in natural experiments)\n:::\n\n::: callout-warning\n## Common Pitfalls to Avoid\n\n1.  **Pseudoreplication:** Taking multiple measurements from the same experimental unit\n2.  **Inadequate Power:** Collecting too few samples to detect meaningful effects\n3.  **Poor Controls:** Not controlling for important confounding variables\n4.  **Non-random Sampling:** Introducing bias through convenience sampling\n5.  **HARKing:** Hypothesizing After Results are Known\n\n**The Golden Rule:** Plan your analysis when you plan your experiment!\n:::\n\n# **Practice Problems**\n\n::: callout-important\n## Challenge Problems\n\nTry these on your own to test your understanding:\n\n**Problem 1:** A researcher wants to test if tree diameter affects needle length. They measure diameter and needle length on 50 randomly selected pine trees. - What type of study is this? - What statistical test would be appropriate? - What are potential confounding variables?\n\n**Problem 2:** An experiment tests three fertilizer types (A, B, control) with 5 trees per treatment. From each tree, they collect 20 needles and measure length. - Is this proper replication? - What's the actual sample size for statistical purposes? - How would you redesign this study?\n\n**Problem 3:** Calculate sample size needed to detect a 15mm difference in needle length between treatments, with SD = 20mm and 90% power.\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Your code here for Problem 3\neffect_size <- ___\npower_result <- pwr.t.test(\n  d = ___,\n  sig.level = ___,\n  power = ___,\n  type = \"two.sample\"\n)\n```\n:::\n\n\n\n\n\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": null,
    "postProcess": false
  }
}