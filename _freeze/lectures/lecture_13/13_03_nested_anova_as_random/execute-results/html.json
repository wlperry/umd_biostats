{
  "hash": "d4fca185e7b2da3692447683219bd613",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Lecture 13 - NESTED ANOVA\"\nauthor: \"Bill Perry\"\nexecute:\n  freeze: auto\n  cache: true\n  echo: true\n  keep-md: true\n  message: false\n  warning: false\n  fig-height: 5\n  fig-width: 4\n  paged-print: false\nformat:\n  html:\n    toc: false\n    output-file: \"13_03_nested_anova_random_html.html\"\n    embed-resources: true\n    self-contained: true\n    max-width: 80ch\n    css: ../../css/lecture.css\n  revealjs:\n    output-file: \"13_03_nested_anova_random_slides.html\"\n    self-contained: true\n    css: ../../css/lecture.css\n    slide-number: true\n    transition: fade\n  docx:\n    default: true\n    toc: false\n    toc-depth: 3\n    number-sections: true\n    highlight-style: github\n    reference-doc: ../../ms_templates/custom-reference.docx\n    css: msword.css\n    embed-resources: true\n  pptx:\n    reference-doc: ../../ms_templates/lecture_template.pptx \n    embed-resources: true\neditor: visual\n---\n\n\n\n\n\n\n\n\n# Introduction\n\nThis analysis examines the effects of varying sea urchin densities on the percentage cover of filamentous algae. The experiment was designed with four urchin density treatments (control, 66% of original density, 33% of original density, and all urchins removed) nested within four random patches. Five replicate quadrats were measured within each treatment-patch combination.\n\nThe traditional nested ANOVA approach can be implemented using a linear mixed-effects model, which provides a more flexible framework for analyzing hierarchical designs. In this case, we'll use the `lme4` package to fit a model where treatment is a fixed effect and patch is a random effect nested within treatment.\n\n# Data Overview\n\nThe dataframe contains 80 observations with the following variables:\n\n-   TREAT: Urchin density treatment (Control, 66% Density, 33% Density, Removed)\n-   PATCH: Random patches (1-16) where treatments were applied\n-   QUAD: Replicate quadrats within each treatment-patch combination\n-   ALGAE: Percentage cover of filamentous algae (response variable)\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create a summary table with flextable\n\nsummary_stats\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 4 × 7\n  TREAT           n  mean    sd    se   min   max\n  <fct>       <int> <dbl> <dbl> <dbl> <dbl> <dbl>\n1 Control        20   1.3  3.18 0.711     0    13\n2 66% Density    20  21.6 25.1  5.62      0    79\n3 33% Density    20  19   25.7  5.74      0    71\n4 Removed        20  39.2 28.7  6.41      0    83\n```\n\n\n:::\n\n```{.r .cell-code}\n# \n# summary_stats %>%\n#   select(TREAT, n, mean, sd, se, min, max) %>%\n#   flextable() %>%\n#   set_header_labels(\n#     TREAT = \"Treatment\",\n#     n = \"N\",\n#     mean = \"Mean\",\n#     sd = \"SD\",\n#     se = \"SE\",\n#     min = \"Min\",\n#     max = \"Max\"\n#   ) %>%\n#   colformat_double(j = c(\"mean\", \"sd\", \"se\", \"min\", \"max\"), digits = 2) %>%\n#   autofit() %>%\n#   add_header_lines(\"Summary statistics of algae cover (%) across treatments\") %>%\n#   theme_box()\n```\n:::\n\n\n\n\n\n\n# Mixed Model Analysis\n\nIn this experimental design, PATCH is nested within TREAT because each patch received only one treatment level. This hierarchical design is well-suited for analysis using linear mixed-effects models.\n\n## Model Specification\n\nWe'll use the following model specification:\n\n$ALGAE_{ijk} = \\mu + \\alpha_i + \\beta_{j(i)} + \\epsilon_{ijk}$\n\nWhere: - $\\mu$ is the overall mean - $\\alpha_i$ is the fixed effect of treatment $i$ - $\\beta_{j(i)}$ is the random effect of patch $j$ nested within treatment $i$ - $\\epsilon_{ijk}$ is the residual error for quadrat $k$ in patch $j$ within treatment $i$\n\nIn `lme4`, this model is specified as\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Fit the mixed model\nmixed_model <- lmer(ALGAE ~ TREAT + (1|TREAT:PATCH), data = andrew)\n\n# Display model summary\nsummary(mixed_model)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nLinear mixed model fit by REML. t-tests use Satterthwaite's method [\nlmerModLmerTest]\nFormula: ALGAE ~ TREAT + (1 | TREAT:PATCH)\n   Data: andrew\n\nREML criterion at convergence: 682.2\n\nScaled residuals: \n    Min      1Q  Median      3Q     Max \n-1.9808 -0.3106 -0.1093  0.2831  2.5910 \n\nRandom effects:\n Groups      Name        Variance Std.Dev.\n TREAT:PATCH (Intercept) 294.3    17.16   \n Residual                298.6    17.28   \nNumber of obs: 80, groups:  TREAT:PATCH, 16\n\nFixed effects:\n                 Estimate Std. Error     df t value Pr(>|t|)  \n(Intercept)         1.300      9.408 12.000   0.138   0.8924  \nTREAT66% Density   20.250     13.305 12.000   1.522   0.1539  \nTREAT33% Density   17.700     13.305 12.000   1.330   0.2081  \nTREATRemoved       37.900     13.305 12.000   2.849   0.0147 *\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nCorrelation of Fixed Effects:\n            (Intr) TREAT6D TREAT3D\nTREAT66%Dns -0.707                \nTREAT33%Dns -0.707  0.500         \nTREATRemovd -0.707  0.500   0.500 \n```\n\n\n:::\n:::\n\n\n\n\n\n\n## ANOVA Table\n\nThe ANOVA table for the mixed model:\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Get ANOVA table with Type III tests\nanova_table <- anova(mixed_model, type = 3)\nprint(anova_table)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nType III Analysis of Variance Table with Satterthwaite's method\n      Sum Sq Mean Sq NumDF DenDF F value  Pr(>F)  \nTREAT   2434  811.33     3    12  2.7171 0.09126 .\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n\n```{.r .cell-code}\n# For comparison, also run a traditional nested ANOVA\nnested_aov <- aov(ALGAE ~ TREAT + TREAT:PATCH, data = andrew)\nstd_summary <- summary(nested_aov)[[1]]\n\n# Extract MS values - using exact row names\nMS_treat <- std_summary[\"TREAT      \", \"Mean Sq\"] \nMS_patch <- std_summary[\"TREAT:PATCH\", \"Mean Sq\"]\nMS_residual <- std_summary[\"Residuals\", \"Mean Sq\"]\n\n# Print MS values to check\nprint(\"MS values:\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"MS values:\"\n```\n\n\n:::\n\n```{.r .cell-code}\nprint(c(Treatment = MS_treat, Patches = MS_patch, Residual = MS_residual))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nTreatment   Patches  Residual \n 4809.712  1770.162   298.600 \n```\n\n\n:::\n\n```{.r .cell-code}\n# Extract df values\ndf_treat <- std_summary[\"TREAT      \", \"Df\"]\ndf_patch <- std_summary[\"TREAT:PATCH\", \"Df\"]\ndf_residual <- std_summary[\"Residuals\", \"Df\"]\n\n\n# Calculate correct F ratios for nested design\nF_treat <- MS_treat / MS_patch\nF_patch <- MS_patch / MS_residual\n\n# Calculate p-values\np_treat <- pf(F_treat, df_treat, df_patch, lower.tail = FALSE)\np_patch <- pf(F_patch, df_patch, df_residual, lower.tail = FALSE)\n\n# Create ANOVA table\ntrad_anova_table <- data.frame(\n  Source = c(\"Treatment\", \"Patches (treatment)\", \"Residual\"),\n  df = c(df_treat, df_patch, df_residual),\n  MS = c(MS_treat, MS_patch, MS_residual),\n  F = c(F_treat, F_patch, NA),\n  p = c(p_treat, p_patch, NA)\n)\n\n# Format p-values\ntrad_anova_table$p <- ifelse(trad_anova_table$p < 0.001, \"<0.001\",\n                       ifelse(is.na(trad_anova_table$p), NA,\n                              format(trad_anova_table$p, digits = 3)))\ntrad_anova_table\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n               Source df       MS        F           p\n1           Treatment  3 4809.712 2.717102 0.091262004\n2 Patches (treatment) 12 1770.162 5.928207      <0.001\n3            Residual 64  298.600       NA        <NA>\n```\n\n\n:::\n\n```{.r .cell-code}\n# # Display traditional ANOVA table with flextable\n# trad_anova_table %>%\n#   flextable() %>%\n#   set_header_labels(\n#     Source = \"Source of variation\",\n#     df = \"df\",\n#     MS = \"MS\",\n#     F = \"F\",\n#     p = \"p\"\n#   ) %>%\n#   colformat_double(j = c(\"MS\", \"F\"), digits = 2) %>%\n#   autofit() %>%\n#   add_header_lines(\"ANOVA table for nested design\") %>%\n#   theme_box()\n```\n:::\n\n\n\n\n\n\n## Variance Components\n\nWe can extract the variance components from the mixed model:\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Print corrected results\n\n# Extract variance components\nvc <- VarCorr(mixed_model)\nprint(vc)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n Groups      Name        Std.Dev.\n TREAT:PATCH (Intercept) 17.156  \n Residual                17.280  \n```\n\n\n:::\n\n```{.r .cell-code}\n# Extract variance components\nvar_comp_patch <- as.numeric(vc$`TREAT:PATCH`)\nvar_comp_residual <- attr(vc, \"sc\")^2\n\n# Calculate percentage of total variance\ntotal_var <- var_comp_patch + var_comp_residual\npct_patch <- var_comp_patch / total_var * 100\npct_residual <- var_comp_residual / total_var * 100\n\n# Calculate treatment variance component\nn_quad <- 5  # Number of quadrats per patch\nn_patch <- 4  # Number of patches per treatment\nvar_comp_treatment <- (MS_treat - MS_patch) / (n_quad * n_patch)\n\n# Format variance components for display\nvar_comp_treatment_display <- ifelse(var_comp_treatment < 0, \n                                    paste0(\"(\", format(abs(var_comp_treatment), digits = 2), \")\"),\n                                    format(var_comp_treatment, digits = 2))\n\n# Create variance components table\nvar_comp_table <- data.frame(\n  Source = c(\"Treatment\", \"Patches (treatment)\", \"Residual\"),\n  `Var.comp` = c(var_comp_treatment_display, \n               format(var_comp_patch, digits = 2),\n               format(var_comp_residual, digits = 2))\n)\n\n# Display variance components table\nvar_comp_table %>%\n  flextable() %>%\n  set_header_labels(\n    Source = \"Source of variation\",\n    Var.comp = \"Variance component\"\n  ) %>%\n  autofit() %>%\n  add_header_lines(\"Variance components\") %>%\n  theme_box()\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"tabwid\"><style>.cl-a88f3f16{}.cl-a88b3290{font-family:'Helvetica';font-size:11pt;font-weight:bold;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-a88b32a4{font-family:'Helvetica';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-a88c82e4{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-a88c94dc{width:1.627in;background-color:transparent;vertical-align: middle;border-bottom: 0.75pt solid rgba(102, 102, 102, 1.00);border-top: 0.75pt solid rgba(102, 102, 102, 1.00);border-left: 0.75pt solid rgba(102, 102, 102, 1.00);border-right: 0.75pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a88c94dd{width:1.687in;background-color:transparent;vertical-align: middle;border-bottom: 0.75pt solid rgba(102, 102, 102, 1.00);border-top: 0.75pt solid rgba(102, 102, 102, 1.00);border-left: 0.75pt solid rgba(102, 102, 102, 1.00);border-right: 0.75pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a88c94e6{width:1.627in;background-color:transparent;vertical-align: middle;border-bottom: 0.75pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0.75pt solid rgba(102, 102, 102, 1.00);border-right: 0.75pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a88c94e7{width:1.687in;background-color:transparent;vertical-align: middle;border-bottom: 0.75pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0.75pt solid rgba(102, 102, 102, 1.00);border-right: 0.75pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a88c94f0{width:1.627in;background-color:transparent;vertical-align: middle;border-bottom: 0.75pt solid rgba(102, 102, 102, 1.00);border-top: 0.75pt solid rgba(102, 102, 102, 1.00);border-left: 0.75pt solid rgba(102, 102, 102, 1.00);border-right: 0.75pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a88c94f1{width:1.687in;background-color:transparent;vertical-align: middle;border-bottom: 0.75pt solid rgba(102, 102, 102, 1.00);border-top: 0.75pt solid rgba(102, 102, 102, 1.00);border-left: 0.75pt solid rgba(102, 102, 102, 1.00);border-right: 0.75pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a88c94f2{width:1.627in;background-color:transparent;vertical-align: middle;border-bottom: 0.75pt solid rgba(102, 102, 102, 1.00);border-top: 0.75pt solid rgba(102, 102, 102, 1.00);border-left: 0.75pt solid rgba(102, 102, 102, 1.00);border-right: 0.75pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a88c94fa{width:1.687in;background-color:transparent;vertical-align: middle;border-bottom: 0.75pt solid rgba(102, 102, 102, 1.00);border-top: 0.75pt solid rgba(102, 102, 102, 1.00);border-left: 0.75pt solid rgba(102, 102, 102, 1.00);border-right: 0.75pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-a88f3f16'><thead><tr style=\"overflow-wrap:break-word;\"><th  colspan=\"2\"class=\"cl-a88c94dc\"><p class=\"cl-a88c82e4\"><span class=\"cl-a88b3290\">Variance components</span></p></th></tr><tr style=\"overflow-wrap:break-word;\"><th class=\"cl-a88c94dc\"><p class=\"cl-a88c82e4\"><span class=\"cl-a88b3290\">Source of variation</span></p></th><th class=\"cl-a88c94dd\"><p class=\"cl-a88c82e4\"><span class=\"cl-a88b3290\">Variance component</span></p></th></tr></thead><tbody><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-a88c94e6\"><p class=\"cl-a88c82e4\"><span class=\"cl-a88b32a4\">Treatment</span></p></td><td class=\"cl-a88c94e7\"><p class=\"cl-a88c82e4\"><span class=\"cl-a88b32a4\">152</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-a88c94f0\"><p class=\"cl-a88c82e4\"><span class=\"cl-a88b32a4\">Patches (treatment)</span></p></td><td class=\"cl-a88c94f1\"><p class=\"cl-a88c82e4\"><span class=\"cl-a88b32a4\">294</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-a88c94f2\"><p class=\"cl-a88c82e4\"><span class=\"cl-a88b32a4\">Residual</span></p></td><td class=\"cl-a88c94fa\"><p class=\"cl-a88c82e4\"><span class=\"cl-a88b32a4\">299</span></p></td></tr></tbody></table></div>\n```\n\n:::\n\n```{.r .cell-code}\n# Complete table with all information\ncomplete_table <- data.frame(\n  Source = c(\"Treatment\", \"Patches (treatment)\", \"Residual\"),\n  df = c(df_treat, df_patch, df_residual),\n  MS = c(MS_treat, MS_patch, MS_residual),\n  F = c(F_treat, F_patch, NA),\n  p = c(trad_anova_table$p[1], trad_anova_table$p[2], NA),\n  `Var.comp` = c(var_comp_treatment_display, \n                format(var_comp_patch, digits = 2),\n                format(var_comp_residual, digits = 2))\n)\n\n# Display complete table\ncomplete_table %>%\n  flextable() %>%\n  set_header_labels(\n    Source = \"Source of variation\",\n    df = \"df\",\n    MS = \"MS\",\n    F = \"F\",\n    p = \"p\",\n    Var.comp = \"Var. comp.\"\n  ) %>%\n  colformat_double(j = c(\"MS\", \"F\"), digits = 2) %>%\n  autofit() %>%\n  add_header_lines(\"Complete ANOVA table with variance components\") %>%\n  theme_box()\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"tabwid\"><style>.cl-a89dc81a{}.cl-a89acd4a{font-family:'Helvetica';font-size:11pt;font-weight:bold;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-a89acd4b{font-family:'Helvetica';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-a89c030e{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-a89c0318{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-a89c0f84{width:1.627in;background-color:transparent;vertical-align: middle;border-bottom: 0.75pt solid rgba(102, 102, 102, 1.00);border-top: 0.75pt solid rgba(102, 102, 102, 1.00);border-left: 0.75pt solid rgba(102, 102, 102, 1.00);border-right: 0.75pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a89c0f85{width:0.455in;background-color:transparent;vertical-align: middle;border-bottom: 0.75pt solid rgba(102, 102, 102, 1.00);border-top: 0.75pt solid rgba(102, 102, 102, 1.00);border-left: 0.75pt solid rgba(102, 102, 102, 1.00);border-right: 0.75pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a89c0f86{width:0.88in;background-color:transparent;vertical-align: middle;border-bottom: 0.75pt solid rgba(102, 102, 102, 1.00);border-top: 0.75pt solid rgba(102, 102, 102, 1.00);border-left: 0.75pt solid rgba(102, 102, 102, 1.00);border-right: 0.75pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a89c0f8e{width:0.583in;background-color:transparent;vertical-align: middle;border-bottom: 0.75pt solid rgba(102, 102, 102, 1.00);border-top: 0.75pt solid rgba(102, 102, 102, 1.00);border-left: 0.75pt solid rgba(102, 102, 102, 1.00);border-right: 0.75pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a89c0f8f{width:1.177in;background-color:transparent;vertical-align: middle;border-bottom: 0.75pt solid rgba(102, 102, 102, 1.00);border-top: 0.75pt solid rgba(102, 102, 102, 1.00);border-left: 0.75pt solid rgba(102, 102, 102, 1.00);border-right: 0.75pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a89c0f90{width:1.024in;background-color:transparent;vertical-align: middle;border-bottom: 0.75pt solid rgba(102, 102, 102, 1.00);border-top: 0.75pt solid rgba(102, 102, 102, 1.00);border-left: 0.75pt solid rgba(102, 102, 102, 1.00);border-right: 0.75pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a89c0f98{width:1.627in;background-color:transparent;vertical-align: middle;border-bottom: 0.75pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0.75pt solid rgba(102, 102, 102, 1.00);border-right: 0.75pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a89c0f99{width:0.455in;background-color:transparent;vertical-align: middle;border-bottom: 0.75pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0.75pt solid rgba(102, 102, 102, 1.00);border-right: 0.75pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a89c0f9a{width:0.88in;background-color:transparent;vertical-align: middle;border-bottom: 0.75pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0.75pt solid rgba(102, 102, 102, 1.00);border-right: 0.75pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a89c0fa2{width:0.583in;background-color:transparent;vertical-align: middle;border-bottom: 0.75pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0.75pt solid rgba(102, 102, 102, 1.00);border-right: 0.75pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a89c0fa3{width:1.177in;background-color:transparent;vertical-align: middle;border-bottom: 0.75pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0.75pt solid rgba(102, 102, 102, 1.00);border-right: 0.75pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a89c0fa4{width:1.024in;background-color:transparent;vertical-align: middle;border-bottom: 0.75pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0.75pt solid rgba(102, 102, 102, 1.00);border-right: 0.75pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a89c0fac{width:1.627in;background-color:transparent;vertical-align: middle;border-bottom: 0.75pt solid rgba(102, 102, 102, 1.00);border-top: 0.75pt solid rgba(102, 102, 102, 1.00);border-left: 0.75pt solid rgba(102, 102, 102, 1.00);border-right: 0.75pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a89c0fad{width:0.455in;background-color:transparent;vertical-align: middle;border-bottom: 0.75pt solid rgba(102, 102, 102, 1.00);border-top: 0.75pt solid rgba(102, 102, 102, 1.00);border-left: 0.75pt solid rgba(102, 102, 102, 1.00);border-right: 0.75pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a89c0fb6{width:0.88in;background-color:transparent;vertical-align: middle;border-bottom: 0.75pt solid rgba(102, 102, 102, 1.00);border-top: 0.75pt solid rgba(102, 102, 102, 1.00);border-left: 0.75pt solid rgba(102, 102, 102, 1.00);border-right: 0.75pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a89c0fb7{width:0.583in;background-color:transparent;vertical-align: middle;border-bottom: 0.75pt solid rgba(102, 102, 102, 1.00);border-top: 0.75pt solid rgba(102, 102, 102, 1.00);border-left: 0.75pt solid rgba(102, 102, 102, 1.00);border-right: 0.75pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a89c0fc0{width:1.177in;background-color:transparent;vertical-align: middle;border-bottom: 0.75pt solid rgba(102, 102, 102, 1.00);border-top: 0.75pt solid rgba(102, 102, 102, 1.00);border-left: 0.75pt solid rgba(102, 102, 102, 1.00);border-right: 0.75pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a89c0fc1{width:1.024in;background-color:transparent;vertical-align: middle;border-bottom: 0.75pt solid rgba(102, 102, 102, 1.00);border-top: 0.75pt solid rgba(102, 102, 102, 1.00);border-left: 0.75pt solid rgba(102, 102, 102, 1.00);border-right: 0.75pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a89c0fca{width:1.627in;background-color:transparent;vertical-align: middle;border-bottom: 0.75pt solid rgba(102, 102, 102, 1.00);border-top: 0.75pt solid rgba(102, 102, 102, 1.00);border-left: 0.75pt solid rgba(102, 102, 102, 1.00);border-right: 0.75pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a89c0fcb{width:0.455in;background-color:transparent;vertical-align: middle;border-bottom: 0.75pt solid rgba(102, 102, 102, 1.00);border-top: 0.75pt solid rgba(102, 102, 102, 1.00);border-left: 0.75pt solid rgba(102, 102, 102, 1.00);border-right: 0.75pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a89c0fd4{width:0.88in;background-color:transparent;vertical-align: middle;border-bottom: 0.75pt solid rgba(102, 102, 102, 1.00);border-top: 0.75pt solid rgba(102, 102, 102, 1.00);border-left: 0.75pt solid rgba(102, 102, 102, 1.00);border-right: 0.75pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a89c0fd5{width:0.583in;background-color:transparent;vertical-align: middle;border-bottom: 0.75pt solid rgba(102, 102, 102, 1.00);border-top: 0.75pt solid rgba(102, 102, 102, 1.00);border-left: 0.75pt solid rgba(102, 102, 102, 1.00);border-right: 0.75pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a89c0fde{width:1.177in;background-color:transparent;vertical-align: middle;border-bottom: 0.75pt solid rgba(102, 102, 102, 1.00);border-top: 0.75pt solid rgba(102, 102, 102, 1.00);border-left: 0.75pt solid rgba(102, 102, 102, 1.00);border-right: 0.75pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-a89c0fdf{width:1.024in;background-color:transparent;vertical-align: middle;border-bottom: 0.75pt solid rgba(102, 102, 102, 1.00);border-top: 0.75pt solid rgba(102, 102, 102, 1.00);border-left: 0.75pt solid rgba(102, 102, 102, 1.00);border-right: 0.75pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-a89dc81a'><thead><tr style=\"overflow-wrap:break-word;\"><th  colspan=\"6\"class=\"cl-a89c0f84\"><p class=\"cl-a89c030e\"><span class=\"cl-a89acd4a\">Complete ANOVA table with variance components</span></p></th></tr><tr style=\"overflow-wrap:break-word;\"><th class=\"cl-a89c0f84\"><p class=\"cl-a89c030e\"><span class=\"cl-a89acd4a\">Source of variation</span></p></th><th class=\"cl-a89c0f85\"><p class=\"cl-a89c0318\"><span class=\"cl-a89acd4a\">df</span></p></th><th class=\"cl-a89c0f86\"><p class=\"cl-a89c0318\"><span class=\"cl-a89acd4a\">MS</span></p></th><th class=\"cl-a89c0f8e\"><p class=\"cl-a89c0318\"><span class=\"cl-a89acd4a\">F</span></p></th><th class=\"cl-a89c0f8f\"><p class=\"cl-a89c030e\"><span class=\"cl-a89acd4a\">p</span></p></th><th class=\"cl-a89c0f90\"><p class=\"cl-a89c030e\"><span class=\"cl-a89acd4a\">Var. comp.</span></p></th></tr></thead><tbody><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-a89c0f98\"><p class=\"cl-a89c030e\"><span class=\"cl-a89acd4b\">Treatment</span></p></td><td class=\"cl-a89c0f99\"><p class=\"cl-a89c0318\"><span class=\"cl-a89acd4b\">3</span></p></td><td class=\"cl-a89c0f9a\"><p class=\"cl-a89c0318\"><span class=\"cl-a89acd4b\">4,809.71</span></p></td><td class=\"cl-a89c0fa2\"><p class=\"cl-a89c0318\"><span class=\"cl-a89acd4b\">2.72</span></p></td><td class=\"cl-a89c0fa3\"><p class=\"cl-a89c030e\"><span class=\"cl-a89acd4b\">0.091262004</span></p></td><td class=\"cl-a89c0fa4\"><p class=\"cl-a89c030e\"><span class=\"cl-a89acd4b\">152</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-a89c0fac\"><p class=\"cl-a89c030e\"><span class=\"cl-a89acd4b\">Patches (treatment)</span></p></td><td class=\"cl-a89c0fad\"><p class=\"cl-a89c0318\"><span class=\"cl-a89acd4b\">12</span></p></td><td class=\"cl-a89c0fb6\"><p class=\"cl-a89c0318\"><span class=\"cl-a89acd4b\">1,770.16</span></p></td><td class=\"cl-a89c0fb7\"><p class=\"cl-a89c0318\"><span class=\"cl-a89acd4b\">5.93</span></p></td><td class=\"cl-a89c0fc0\"><p class=\"cl-a89c030e\"><span class=\"cl-a89acd4b\">&lt;0.001</span></p></td><td class=\"cl-a89c0fc1\"><p class=\"cl-a89c030e\"><span class=\"cl-a89acd4b\">294</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-a89c0fca\"><p class=\"cl-a89c030e\"><span class=\"cl-a89acd4b\">Residual</span></p></td><td class=\"cl-a89c0fcb\"><p class=\"cl-a89c0318\"><span class=\"cl-a89acd4b\">64</span></p></td><td class=\"cl-a89c0fd4\"><p class=\"cl-a89c0318\"><span class=\"cl-a89acd4b\">298.60</span></p></td><td class=\"cl-a89c0fd5\"><p class=\"cl-a89c0318\"><span class=\"cl-a89acd4b\"></span></p></td><td class=\"cl-a89c0fde\"><p class=\"cl-a89c030e\"><span class=\"cl-a89acd4b\"></span></p></td><td class=\"cl-a89c0fdf\"><p class=\"cl-a89c030e\"><span class=\"cl-a89acd4b\">299</span></p></td></tr></tbody></table></div>\n```\n\n:::\n:::\n\n\n\n\n\n\n::: {.callout-important appearance=\"simple\"}\n**Interpretation of ANOVA Results**\n\nThe nested ANOVA using mixed models reveals that there was no significant effect of urchin density treatment on algae cover (F = 2.72, df = 3, 12, p = 0.0913). However, there was significant variation among patches within treatments (F = 5.93, df = 12, 64, p \\< 0.001).\n\nThe variance component for patches nested within treatments (294) indicates substantial spatial heterogeneity in algae cover, highlighting the importance of accounting for this spatial variation in the analysis. The negative variance component for treatment suggests that there is more variation among patches within treatments than among treatments themselves.\n:::\n\n# Lecture 13: Post-hoc Comparisons\n\nAlthough the main effect of treatment was not significant in the nested ANOVA (p = r format(p_treat, digits=3)), we can still examine the mean differences between treatments to understand patterns in the data. However, we should interpret these with caution given the lack of statistical significance at the α = 0.05 level.\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Calculate estimated marginal means\nemm <- emmeans(mixed_model, ~ TREAT)\n\n# Display EMMs with flextable\nas.data.frame(summary(emm)) %>%\n  flextable() %>%\n  set_header_labels(\n    TREAT = \"Treatment\",\n    emmean = \"Estimated Marginal Mean\",\n    SE = \"Standard Error\",\n    df = \"df\",\n    lower.CL = \"Lower CL\",\n    upper.CL = \"Upper CL\"\n  ) %>%\n  colformat_double(j = c(\"emmean\", \"SE\", \"lower.CL\", \"upper.CL\"), digits = 2) %>%\n  autofit() %>%\n  add_header_lines(\"Estimated marginal means for each treatment\") %>%\n  theme_box()\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"tabwid\"><style>.cl-0ae9281a{}.cl-0ae541a0{font-family:'Helvetica';font-size:11pt;font-weight:bold;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-0ae541b4{font-family:'Helvetica';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-0ae73712{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-0ae7371c{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-0ae74504{width:1.143in;background-color:transparent;vertical-align: middle;border-bottom: 0.75pt solid rgba(102, 102, 102, 1.00);border-top: 0.75pt solid rgba(102, 102, 102, 1.00);border-left: 0.75pt solid rgba(102, 102, 102, 1.00);border-right: 0.75pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-0ae74505{width:2.017in;background-color:transparent;vertical-align: middle;border-bottom: 0.75pt solid rgba(102, 102, 102, 1.00);border-top: 0.75pt solid rgba(102, 102, 102, 1.00);border-left: 0.75pt solid rgba(102, 102, 102, 1.00);border-right: 0.75pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-0ae74506{width:1.287in;background-color:transparent;vertical-align: middle;border-bottom: 0.75pt solid rgba(102, 102, 102, 1.00);border-top: 0.75pt solid rgba(102, 102, 102, 1.00);border-left: 0.75pt solid rgba(102, 102, 102, 1.00);border-right: 0.75pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-0ae74507{width:0.455in;background-color:transparent;vertical-align: middle;border-bottom: 0.75pt solid rgba(102, 102, 102, 1.00);border-top: 0.75pt solid rgba(102, 102, 102, 1.00);border-left: 0.75pt solid rgba(102, 102, 102, 1.00);border-right: 0.75pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-0ae74508{width:0.939in;background-color:transparent;vertical-align: middle;border-bottom: 0.75pt solid rgba(102, 102, 102, 1.00);border-top: 0.75pt solid rgba(102, 102, 102, 1.00);border-left: 0.75pt solid rgba(102, 102, 102, 1.00);border-right: 0.75pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-0ae7450e{width:1.143in;background-color:transparent;vertical-align: middle;border-bottom: 0.75pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0.75pt solid rgba(102, 102, 102, 1.00);border-right: 0.75pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-0ae7450f{width:2.017in;background-color:transparent;vertical-align: middle;border-bottom: 0.75pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0.75pt solid rgba(102, 102, 102, 1.00);border-right: 0.75pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-0ae74510{width:1.287in;background-color:transparent;vertical-align: middle;border-bottom: 0.75pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0.75pt solid rgba(102, 102, 102, 1.00);border-right: 0.75pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-0ae74511{width:0.455in;background-color:transparent;vertical-align: middle;border-bottom: 0.75pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0.75pt solid rgba(102, 102, 102, 1.00);border-right: 0.75pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-0ae74518{width:0.939in;background-color:transparent;vertical-align: middle;border-bottom: 0.75pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0.75pt solid rgba(102, 102, 102, 1.00);border-right: 0.75pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-0ae74519{width:1.143in;background-color:transparent;vertical-align: middle;border-bottom: 0.75pt solid rgba(102, 102, 102, 1.00);border-top: 0.75pt solid rgba(102, 102, 102, 1.00);border-left: 0.75pt solid rgba(102, 102, 102, 1.00);border-right: 0.75pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-0ae7451a{width:2.017in;background-color:transparent;vertical-align: middle;border-bottom: 0.75pt solid rgba(102, 102, 102, 1.00);border-top: 0.75pt solid rgba(102, 102, 102, 1.00);border-left: 0.75pt solid rgba(102, 102, 102, 1.00);border-right: 0.75pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-0ae7451b{width:1.287in;background-color:transparent;vertical-align: middle;border-bottom: 0.75pt solid rgba(102, 102, 102, 1.00);border-top: 0.75pt solid rgba(102, 102, 102, 1.00);border-left: 0.75pt solid rgba(102, 102, 102, 1.00);border-right: 0.75pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-0ae7451c{width:0.455in;background-color:transparent;vertical-align: middle;border-bottom: 0.75pt solid rgba(102, 102, 102, 1.00);border-top: 0.75pt solid rgba(102, 102, 102, 1.00);border-left: 0.75pt solid rgba(102, 102, 102, 1.00);border-right: 0.75pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-0ae7451d{width:0.939in;background-color:transparent;vertical-align: middle;border-bottom: 0.75pt solid rgba(102, 102, 102, 1.00);border-top: 0.75pt solid rgba(102, 102, 102, 1.00);border-left: 0.75pt solid rgba(102, 102, 102, 1.00);border-right: 0.75pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-0ae74522{width:1.143in;background-color:transparent;vertical-align: middle;border-bottom: 0.75pt solid rgba(102, 102, 102, 1.00);border-top: 0.75pt solid rgba(102, 102, 102, 1.00);border-left: 0.75pt solid rgba(102, 102, 102, 1.00);border-right: 0.75pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-0ae74523{width:2.017in;background-color:transparent;vertical-align: middle;border-bottom: 0.75pt solid rgba(102, 102, 102, 1.00);border-top: 0.75pt solid rgba(102, 102, 102, 1.00);border-left: 0.75pt solid rgba(102, 102, 102, 1.00);border-right: 0.75pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-0ae74524{width:1.287in;background-color:transparent;vertical-align: middle;border-bottom: 0.75pt solid rgba(102, 102, 102, 1.00);border-top: 0.75pt solid rgba(102, 102, 102, 1.00);border-left: 0.75pt solid rgba(102, 102, 102, 1.00);border-right: 0.75pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-0ae74525{width:0.455in;background-color:transparent;vertical-align: middle;border-bottom: 0.75pt solid rgba(102, 102, 102, 1.00);border-top: 0.75pt solid rgba(102, 102, 102, 1.00);border-left: 0.75pt solid rgba(102, 102, 102, 1.00);border-right: 0.75pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-0ae74526{width:0.939in;background-color:transparent;vertical-align: middle;border-bottom: 0.75pt solid rgba(102, 102, 102, 1.00);border-top: 0.75pt solid rgba(102, 102, 102, 1.00);border-left: 0.75pt solid rgba(102, 102, 102, 1.00);border-right: 0.75pt solid rgba(102, 102, 102, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-0ae9281a'><thead><tr style=\"overflow-wrap:break-word;\"><th  colspan=\"6\"class=\"cl-0ae74504\"><p class=\"cl-0ae73712\"><span class=\"cl-0ae541a0\">Estimated marginal means for each treatment</span></p></th></tr><tr style=\"overflow-wrap:break-word;\"><th class=\"cl-0ae74504\"><p class=\"cl-0ae73712\"><span class=\"cl-0ae541a0\">Treatment</span></p></th><th class=\"cl-0ae74505\"><p class=\"cl-0ae7371c\"><span class=\"cl-0ae541a0\">Estimated Marginal Mean</span></p></th><th class=\"cl-0ae74506\"><p class=\"cl-0ae7371c\"><span class=\"cl-0ae541a0\">Standard Error</span></p></th><th class=\"cl-0ae74507\"><p class=\"cl-0ae7371c\"><span class=\"cl-0ae541a0\">df</span></p></th><th class=\"cl-0ae74508\"><p class=\"cl-0ae7371c\"><span class=\"cl-0ae541a0\">Lower CL</span></p></th><th class=\"cl-0ae74508\"><p class=\"cl-0ae7371c\"><span class=\"cl-0ae541a0\">Upper CL</span></p></th></tr></thead><tbody><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-0ae7450e\"><p class=\"cl-0ae73712\"><span class=\"cl-0ae541b4\">Control</span></p></td><td class=\"cl-0ae7450f\"><p class=\"cl-0ae7371c\"><span class=\"cl-0ae541b4\">1.30</span></p></td><td class=\"cl-0ae74510\"><p class=\"cl-0ae7371c\"><span class=\"cl-0ae541b4\">9.41</span></p></td><td class=\"cl-0ae74511\"><p class=\"cl-0ae7371c\"><span class=\"cl-0ae541b4\">12</span></p></td><td class=\"cl-0ae74518\"><p class=\"cl-0ae7371c\"><span class=\"cl-0ae541b4\">-19.20</span></p></td><td class=\"cl-0ae74518\"><p class=\"cl-0ae7371c\"><span class=\"cl-0ae541b4\">21.80</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-0ae74519\"><p class=\"cl-0ae73712\"><span class=\"cl-0ae541b4\">66% Density</span></p></td><td class=\"cl-0ae7451a\"><p class=\"cl-0ae7371c\"><span class=\"cl-0ae541b4\">21.55</span></p></td><td class=\"cl-0ae7451b\"><p class=\"cl-0ae7371c\"><span class=\"cl-0ae541b4\">9.41</span></p></td><td class=\"cl-0ae7451c\"><p class=\"cl-0ae7371c\"><span class=\"cl-0ae541b4\">12</span></p></td><td class=\"cl-0ae7451d\"><p class=\"cl-0ae7371c\"><span class=\"cl-0ae541b4\">1.05</span></p></td><td class=\"cl-0ae7451d\"><p class=\"cl-0ae7371c\"><span class=\"cl-0ae541b4\">42.05</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-0ae74519\"><p class=\"cl-0ae73712\"><span class=\"cl-0ae541b4\">33% Density</span></p></td><td class=\"cl-0ae7451a\"><p class=\"cl-0ae7371c\"><span class=\"cl-0ae541b4\">19.00</span></p></td><td class=\"cl-0ae7451b\"><p class=\"cl-0ae7371c\"><span class=\"cl-0ae541b4\">9.41</span></p></td><td class=\"cl-0ae7451c\"><p class=\"cl-0ae7371c\"><span class=\"cl-0ae541b4\">12</span></p></td><td class=\"cl-0ae7451d\"><p class=\"cl-0ae7371c\"><span class=\"cl-0ae541b4\">-1.50</span></p></td><td class=\"cl-0ae7451d\"><p class=\"cl-0ae7371c\"><span class=\"cl-0ae541b4\">39.50</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-0ae74522\"><p class=\"cl-0ae73712\"><span class=\"cl-0ae541b4\">Removed</span></p></td><td class=\"cl-0ae74523\"><p class=\"cl-0ae7371c\"><span class=\"cl-0ae541b4\">39.20</span></p></td><td class=\"cl-0ae74524\"><p class=\"cl-0ae7371c\"><span class=\"cl-0ae541b4\">9.41</span></p></td><td class=\"cl-0ae74525\"><p class=\"cl-0ae7371c\"><span class=\"cl-0ae541b4\">12</span></p></td><td class=\"cl-0ae74526\"><p class=\"cl-0ae7371c\"><span class=\"cl-0ae541b4\">18.70</span></p></td><td class=\"cl-0ae74526\"><p class=\"cl-0ae7371c\"><span class=\"cl-0ae541b4\">59.70</span></p></td></tr></tbody></table></div>\n```\n\n:::\n:::\n\n\n\n\n\n\n# Lecture 13: Tukey Pairwise Comparisons\n\n-   text\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Pairwise comparisons with Tukey adjustment\npairs <- pairs(emm, adjust = \"tukey\")\npairs\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n contrast                  estimate   SE df t.ratio p.value\n Control - 66% Density       -20.25 13.3 12  -1.522  0.4553\n Control - 33% Density       -17.70 13.3 12  -1.330  0.5625\n Control - Removed           -37.90 13.3 12  -2.849  0.0615\n 66% Density - 33% Density     2.55 13.3 12   0.192  0.9974\n 66% Density - Removed       -17.65 13.3 12  -1.327  0.5646\n 33% Density - Removed       -20.20 13.3 12  -1.518  0.4573\n\nDegrees-of-freedom method: kenward-roger \nP value adjustment: tukey method for comparing a family of 4 estimates \n```\n\n\n:::\n\n```{.r .cell-code}\n# # Display pairwise comparisons with flextable\n# as.data.frame(summary(pairs)) %>%\n#   flextable() %>%\n#   set_header_labels(\n#     contrast = \"Contrast\",\n#     estimate = \"Estimate\",\n#     SE = \"Standard Error\",\n#     df = \"df\",\n#     t.ratio = \"t ratio\",\n#     p.value = \"p-value\"\n#   ) %>%\n#   colformat_double(j = c(\"estimate\", \"SE\", \"t.ratio\", \"p.value\"), digits = 3) %>%\n#   autofit() %>%\n#   add_header_lines(\"Pairwise comparisons between treatments (Tukey-adjusted)\") %>%\n#   theme_box()\n```\n:::\n\n\n\n\n\n\n# Lecture 13: Letter Display\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Extract compact letter display for plotting\ncld <- multcomp::cld(emm, alpha = 0.05, Letters = letters)\n\ncld\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n TREAT       emmean   SE df lower.CL upper.CL .group\n Control        1.3 9.41 12   -19.20     21.8  a    \n 33% Density   19.0 9.41 12    -1.50     39.5  a    \n 66% Density   21.6 9.41 12     1.05     42.0  a    \n Removed       39.2 9.41 12    18.70     59.7  a    \n\nDegrees-of-freedom method: kenward-roger \nConfidence level used: 0.95 \nP value adjustment: tukey method for comparing a family of 4 estimates \nsignificance level used: alpha = 0.05 \nNOTE: If two or more means share the same grouping symbol,\n      then we cannot show them to be different.\n      But we also did not show them to be the same. \n```\n\n\n:::\n\n```{.r .cell-code}\n# # Display CLD with flextable\n# as.data.frame(cld) %>%\n#   flextable() %>%\n#   set_header_labels(\n#     TREAT = \"Treatment\",\n#     emmean = \"Estimated Marginal Mean\",\n#     SE = \"Standard Error\",\n#     df = \"df\",\n#     lower.CL = \"Lower CL\",\n#     upper.CL = \"Upper CL\",\n#     .group = \"Group\"\n#   ) %>%\n#   colformat_double(j = c(\"emmean\", \"SE\", \"lower.CL\", \"upper.CL\"), digits = 2) %>%\n#   autofit() %>%\n#   add_header_lines(\"Compact letter display of treatment means\") %>%\n#   theme_box()\n```\n:::\n\n\n\n\n\n\n::: {.callout-important appearance=\"simple\"}\nInterpretation of Treatment Comparisons The mean algae cover for the Control treatment (1.30%) appears considerably lower than for the reduced urchin density treatments (66% Density: 21.55%, 33% Density: 19.00%, Removed: 39.20%). While the visual pattern suggests an inverse relationship between urchin density and algae cover, with complete removal showing the highest algae cover, the nested ANOVA showed that these differences were not statistically significant at the α = 0.05 level (p = r format(p_treat, digits=3)). The high variability among patches within treatments likely contributed to the lack of statistical significance for the treatment effect.\n:::\n\n# Assumption Testing\n\nFor valid inference from mixed models, several assumptions must be met. We test these assumptions below.\n\n## Normality of Residuals\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# QQ plot of residuals\nqqnorm(resid(mixed_model))\nqqline(resid(mixed_model))\n```\n\n::: {.cell-output-display}\n![](13_03_nested_anova_as_random_files/figure-html/normality-1.png){width=384}\n:::\n\n```{.r .cell-code}\n# Histogram of residuals\nhist(resid(mixed_model), main = \"Histogram of Residuals\",\n     xlab = \"Residuals\", breaks = 15)\n```\n\n::: {.cell-output-display}\n![](13_03_nested_anova_as_random_files/figure-html/normality-2.png){width=384}\n:::\n\n```{.r .cell-code}\n# More advanced residual diagnostics using DHARMa\nsim_residuals <- simulateResiduals(fittedModel = mixed_model)\nplot(sim_residuals)\n```\n\n::: {.cell-output-display}\n![](13_03_nested_anova_as_random_files/figure-html/normality-3.png){width=384}\n:::\n:::\n\n\n\n\n\n\n## Homogeneity of Variance\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Residuals vs. fitted values plot\nplot(fitted(mixed_model), resid(mixed_model),\n     xlab = \"Fitted Values\", ylab = \"Residuals\",\n     main = \"Residuals vs. Fitted Values\")\nabline(h = 0, lty = 2, col = \"red\")\n```\n\n::: {.cell-output-display}\n![](13_03_nested_anova_as_random_files/figure-html/homogeneity-1.png){width=384}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Levene's test for homogeneity of variance\nlevene_test <- leveneTest(ALGAE ~ TREAT, data = andrew)\nlevene_test\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nLevene's Test for Homogeneity of Variance (center = median)\n      Df F value    Pr(>F)    \ngroup  3  8.1694 8.785e-05 ***\n      76                      \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n:::\n\n\n\n\n\n\n::: {.callout-important appearance=\"simple\"}\n**Interpretation of Assumption Tests**\n\nThe Q-Q plot shows some deviation from normality, particularly in the tails, and Levene's test indicates significant heterogeneity of variances across treatments (F = 8.17, p \\< 0.001). As noted in the original analysis, there were \"large differences in within-cell variances\" in this dataset, and transformations did not improve variance homogeneity.\n\nThe DHARMa residual diagnostics also indicate potential issues with the distribution of residuals and homogeneity of variance. The residuals vs. fitted plot shows a pattern of increasing variance with increasing fitted values, confirming the heteroscedasticity.\n\nHowever, mixed models are generally robust to moderate violations of assumptions, especially with balanced designs. Since transformations were not effective in improving the data properties, analyzing the untransformed data is a reasonable approach in this case.\n:::\n\n# Post-hoc Comparisons\n\nAlthough the main effect of treatment was not significant in the nested ANOVA (p = 0.0913), we can still examine the mean differences between treatments to understand patterns in the data.\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Calculate estimated marginal means\nemm <- emmeans(mixed_model, ~ TREAT)\nemm\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n TREAT       emmean   SE df lower.CL upper.CL\n Control        1.3 9.41 12   -19.20     21.8\n 66% Density   21.6 9.41 12     1.05     42.0\n 33% Density   19.0 9.41 12    -1.50     39.5\n Removed       39.2 9.41 12    18.70     59.7\n\nDegrees-of-freedom method: kenward-roger \nConfidence level used: 0.95 \n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Pairwise comparisons with Tukey adjustment\npairs <- pairs(emm, adjust = \"tukey\")\npairs\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n contrast                  estimate   SE df t.ratio p.value\n Control - 66% Density       -20.25 13.3 12  -1.522  0.4553\n Control - 33% Density       -17.70 13.3 12  -1.330  0.5625\n Control - Removed           -37.90 13.3 12  -2.849  0.0615\n 66% Density - 33% Density     2.55 13.3 12   0.192  0.9974\n 66% Density - Removed       -17.65 13.3 12  -1.327  0.5646\n 33% Density - Removed       -20.20 13.3 12  -1.518  0.4573\n\nDegrees-of-freedom method: kenward-roger \nP value adjustment: tukey method for comparing a family of 4 estimates \n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Compact letter display\ncld <- multcomp::cld(emm, alpha = 0.05, Letters = letters)\ncld\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n TREAT       emmean   SE df lower.CL upper.CL .group\n Control        1.3 9.41 12   -19.20     21.8  a    \n 33% Density   19.0 9.41 12    -1.50     39.5  a    \n 66% Density   21.6 9.41 12     1.05     42.0  a    \n Removed       39.2 9.41 12    18.70     59.7  a    \n\nDegrees-of-freedom method: kenward-roger \nConfidence level used: 0.95 \nP value adjustment: tukey method for comparing a family of 4 estimates \nsignificance level used: alpha = 0.05 \nNOTE: If two or more means share the same grouping symbol,\n      then we cannot show them to be different.\n      But we also did not show them to be the same. \n```\n\n\n:::\n:::\n\n\n\n\n\n\n# Visualization\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create boxplot with jittered points\nggplot_boxplot <- ggplot(andrew, aes(x = TREAT, y = ALGAE, fill = TREAT)) +\n  geom_boxplot(alpha = 0.7, outlier.shape = NA) +\n  geom_jitter(width = 0.2, alpha = 0.4, size = 1) +\n  scale_fill_viridis_d(option = \"D\", end = 0.85) +\n  labs(\n    title = \"Urchin Density effect on Algae Cover\",\n    x = \"Urchin Density \",\n    y = \"Algae Cover (%)\",\n    caption = \"Figure 1: Boxplots showing the distribution of algal cover across urchin density.\\nDespite visual differences, the treatment effect was not statistically significant (p = 0.091).\"\n  ) +\n  theme_minimal() +\n  theme(\n    legend.position = \"none\",\n    plot.title = element_text(face = \"bold\", size = 14),\n    axis.title = element_text(face = \"bold\", size = 12),\n    axis.text = element_text(size = 10),\n    plot.caption = element_text(hjust = 0, face = \"italic\", size = 10)\n  )\n\n# Create means plot with error bars\nmeans_plot <- ggplot(summary_stats, aes(x = TREAT, y = mean, group = 1)) +\n  geom_point(size = 3, shape = 21, fill = \"white\") +\n  geom_errorbar(aes(ymin = mean - se, ymax = mean + se), width = 0.2) +\n  labs(\n    title = \"Mean Algae Cover by Urchin Density\",\n    x = \"Urchin Density\",\n    y = \"Algae Cover (%)\",\n    caption = \"Figure 2: Mean (± SE) percentage cover of algae across urchin density treatments.\"\n  ) +\n  theme_minimal() +\n  theme(\n    plot.title = element_text(face = \"bold\", size = 14),\n    axis.title = element_text(face = \"bold\", size = 12),\n    axis.text = element_text(size = 10),\n    plot.caption = element_text(hjust = 0, face = \"italic\", size = 10)\n  )\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Display plots\nggplot_boxplot\n```\n\n::: {.cell-output-display}\n![](13_03_nested_anova_as_random_files/figure-html/unnamed-chunk-6-1.png){width=384}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmeans_plot\n```\n\n::: {.cell-output-display}\n![](13_03_nested_anova_as_random_files/figure-html/unnamed-chunk-7-1.png){width=384}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Combined plot using patchwork\nggplot_boxplot + means_plot + plot_layout(ncol = 1)\n```\n\n::: {.cell-output-display}\n![](13_03_nested_anova_as_random_files/figure-html/unnamed-chunk-8-1.png){width=576}\n:::\n:::\n\n\n\n\n\n\n# Discussion\n\n::: {.callout-important appearance=\"simple\"}\n**Scientific Interpretation**\n\nOur mixed model analysis of the nested design revealed substantial spatial heterogeneity in algae cover, with significant variation among patches within each treatment (p \\< 0.001). Surprisingly, the effect of urchin density treatments on filamentous algae cover was not statistically significant at the α = 0.05 level (p = 0.091), despite apparent trends in the data.\n\nThe descriptive statistics show a pattern where algae cover appears to increase as urchin density decreases, with the Control treatment (mean = 1.3%) showing minimal algae cover compared to reduced density treatments (66% Density: 21.55%, 33% Density: 19.00%, and Removed: 39.20%). This pattern suggests a potential density-dependent relationship between urchin grazing and algal abundance, but the high variability among patches masked the treatment effect.\n\nThe substantial variance component associated with patches nested within treatments (294.31, approximately 39.5% of total variance) underscores the importance of spatial heterogeneity in structuring algal communities. This finding highlights the necessity of accounting for spatial variability when designing and analyzing ecological field experiments.\n\nFrom an ecological perspective, these results suggest that while sea urchins may influence algal communities through grazing, local environmental factors and patch-specific conditions play a dominant role in determining algae cover. This has important implications for ecosystem management, as it indicates that the effects of urchin density manipulations may be context-dependent and influenced by local environmental conditions.\n:::\n\n# Comparison with Traditional Nested ANOVA\n\nThe linear mixed model approach provides similar results to the traditional nested ANOVA approach. The main advantage of the mixed model is the more elegant handling of random effects and the extensive diagnostic tools available through packages like DHARMa.\n\nThe mixed model approach confirms that:\n\n1.  Treatment effects are not significant (p = 0.091)\n2.  Patches within treatments show significant variation (p \\< 0.001)\n3.  The variance components are similar to those from the traditional approach\n\nIn both methods, the key ecological finding is the strong spatial heterogeneity in algal cover that overrides the grazing effect of urchins at different densities.\n\n# References\n\nAndrew, N. L., & Underwood, A. J. (1993). Density-dependent foraging in the sea urchin Centrostephanus rodgersii on shallow subtidal reefs in New South Wales, Australia. Marine Ecology Progress Series, 99, 89-98.\n\nQuinn, G. P., & Keough, M. J. (2002). Experimental design and data analysis for biologists. Cambridge University Press.\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/tabwid-1.1.3/tabwid.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/tabwid-1.1.3/tabwid.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}